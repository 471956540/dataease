package io.dataease.xpack.permissions.user.dao.ext.mapper;import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;import com.baomidou.mybatisplus.core.mapper.BaseMapper;import com.baomidou.mybatisplus.core.metadata.IPage;import io.dataease.api.permissions.user.vo.UserGridRoleItem;import io.dataease.api.permissions.user.vo.UserGridVO;import io.dataease.api.permissions.user.vo.UserItem;import org.apache.ibatis.annotations.*;import java.util.List;@Mapperpublic interface UserExtMapper extends BaseMapper<UserGridVO> {    @Select(            """                    select                     u.id,u.id as union_id, u.account, u.name, u.email, u.enable, u.create_time                     from per_user u                    ${ew.customSqlSegment}                     """    )    @Results({            @Result(property = "roleItems", many = @Many(select = "roles"), column = "union_id")    })    IPage<UserGridVO> pager(IPage<UserGridVO> page, @Param("ew") QueryWrapper queryWrapper);    @Select(            """                    select pro.id, pro.name                     from per_user pu                     left join per_user_role pur on pur.uid = pu.id                     left join per_role pro on pro.id = pur.rid                     where pu.id = #{uId}                     """    )    List<UserGridRoleItem> roles(@Param("uId") Long uId);    @Select(            """                    select pro.id, pro.name                     from per_user pu                     left join per_user_role pur on pur.uid = pu.id                     left join per_role pro on pro.id = pur.rid                     where pur.rid != #{rId} and pro.org_id = #{oId} and pu.name like CONCAT('%',#{keyword},'%')                    """    )    List<UserItem> optionForRole(@Param("rId") Long rId, @Param("oId") Long oId, @Param("keyword") String keyword);    @Select(            """                    select pro.id, pro.name                     from per_user pu                     left join per_user_role pur on pur.uid = pu.id                     left join per_role pro on pro.id = pur.rid                     where pur.rid = #{rId} and pro.org_id = #{oId} and pu.name like CONCAT('%',#{keyword},'%')                    """    )    List<UserItem> selectedForRole(@Param("rId") Long rId, @Param("oId") Long oId, @Param("keyword") String keyword);    @Delete("delete from per_user_role pur left join  per_role pro on pro.id = pur.rid where pur.uid = #{uId} and pro.org_id = #{oId} ")    int deleteUserRoleMapping(@Param("uId") Long uId, @Param("oId") Long oId);    @Select("select count(*) as rcount from per_user_role pur where pur.uid = #{uId}")    int userRoleMappingCount(@Param("uId") Long uId);}