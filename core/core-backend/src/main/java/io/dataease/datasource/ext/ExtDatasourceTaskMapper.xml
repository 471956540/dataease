<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="io.dataease.datasource.ext.ExtDataSetTaskMapper">

    <resultMap id="BaseResult" type="io.dataease.dto.dataset.DataSetTaskLogDTO"
               extends="io.dataease.plugins.common.base.mapper.DatasetTableTaskLogMapper.BaseResultMap">
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="dataset_name" jdbcType="VARCHAR" property="datasetName"/>
    </resultMap>

    <resultMap id="TaskResult" type="io.dataease.datasource.dto.CoreDatasourceTaskDTO"
               extends="io.dataease.datasource.dao.auto.mapper.CoreDatasourceTaskMapper.BaseResultMap">
        <result column="datasource_name" jdbcType="VARCHAR" property="datasourceName"/>
        <result column="NEXT_FIRE_TIME" jdbcType="BIGINT" property="nextExecTime"/>
    </resultMap>

    <select id="taskWithTriggers" resultMap="TaskResult" parameterType="io.dataease.ext.query.GridExample">
        SELECT core_datasource.name as datasource_name,core_datasource_task.* , qrtz_triggers.NEXT_FIRE_TIME
        FROM core_datasource_task
        left join core_datasource on core_datasource.id=core_datasource_task.target_id
        left join qrtz_triggers on core_datasource_task.id=qrtz_triggers.TRIGGER_NAME
        <if test="_parameter != null">
            <include refid="io.dataease.request.GridSql.gridCondition"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
        <if test="orderByClause == null">
            order by core_datasource_task.create_time desc
        </if>
    </select>

    <select id="lastId" resultType="Long" >
        select  LAST_INSERT_ID()
    </select>

</mapper>
