// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(m,n,d,t,f,a,r,A){m=m([a,r],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(a,g){n.mixin(this,g);this.initialize(a,g)},getTitle:function(a){var g;this.info&&(g=this.titleHasRelatedFields||this.titleHasAsyncExpressions?"":this._getPopupValues(a,
this._fetchAttributes(a,null,this.getExpressionFieldsInTitle()),!0).title);return g||""},getContent:function(a){return this.info?(new A({template:this,graphic:a,chartTheme:this.chartTheme},t.create("div"))).domNode:""}});d("extend-esri")&&n.setObject("dijit.PopupTemplate",m,f);return m})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./ArcadeExpression ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./arcadeProfiles/popupProfile ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),
function(m,n,d,t,f,a,r,A,p,g,u,D,y,z,C,B,G,k,c,w,x,v){m=m(null,{declaredClass:"esri.PopupInfo",_reNewline:/(\n)/ig,_reExprField:/^\s*expression\//i,_reExprFieldPattern:/\{expression\/([^\}]+)\}/ig,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(b,e){if(b){n.mixin(this,e);this.info=b;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var q=this._fieldLabels={},l=this._fieldsMap={};this.info.fieldInfos&&
d.forEach(this.info.fieldInfos,function(b){var h=b.fieldName.toLowerCase(),e=this._isExpressionField(h)?this.getExpressionInfo(h):null;q[h]=e?e.title:b.label;l[h]=b},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix));this.titleHasAsyncExpressions=this._titleHasAsyncExpressions();this.contentHasAsyncExpressions=this._contentHasAyncExpressions()}},toJson:function(){return t.fromJson(t.toJson(this.info))},getTitle:function(){},getContent:function(){},
getFieldInfo:function(b){var e;d.some(this.info&&this.info.fieldInfos,function(q){q.fieldName===b&&(e=q);return!!e});return e},getExpressionInfo:function(b){if(b=this._getExprField(b)){b=b.toLowerCase();var e;d.some(this.info.expressionInfos,function(q){q.name.toLowerCase()===b&&(e=q);return!!e});return e}},getExpressionFieldsInTitle:function(){return this._getExprFieldsFromTemplatedString(this.info.title)},getExpressionFieldsInContent:function(){var b=this._collectExprFieldsFromTemplatedString(this.info.description,
[]);this.info.description||d.forEach(this.info.fieldInfos,function(e){e.visible&&this._collectExprField(e.fieldName,b)},this);d.forEach(this.info.mediaInfos,function(e){this._collectExprFieldsFromTemplatedString(e.title,b);this._collectExprFieldsFromTemplatedString(e.caption,b);if(e=e.value)this._collectExprFieldsFromTemplatedString(e.linkURL,b),this._collectExprFieldsFromTemplatedString(e.sourceURL,b),d.forEach(e.fields,function(e){this._collectExprField(e,b)},this),this._collectExprField(e.normalizeField,
b),this._collectExprField(e.tooltipField,b)},this);return b},getRequiredExpressionFields:function(){return this.getExpressionFieldsInTitle().concat(this.getExpressionFieldsInContent())},hasGeometryOperations:function(){return d.some(this._getArcadeExpressions(),function(b){return b.hasGeometryOperations()})},hasAsyncExpressions:function(){return d.some(this._getArcadeExpressions(),function(b){return b.async})},initializeArcadeEngine:function(){return w.initialize(this._getArcadeExpressions())},getComponents:function(b,
e){var q=this.info,l={initArcadeEngine:this.initializeArcadeEngine()};q.fieldInfos&&(q=d.filter(q.fieldInfos,function(b){return-1!==b.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<q.length&&(l.relatedInfo=this._getRelatedRecords({graphic:b,fieldsInfo:q}));this._needFullResolutionFeature(b)&&(l.fullResolutionFeature=this._getFullResolutionFeature(b));return z(l).then(n.hitch(this,function(l){l=l.fullResolutionFeature;var h=e&&e.evaluateAllExpressions,q=h?null:this.getRequiredExpressionFields();
l=(h?this.hasAsyncExpressions():this._hasAsyncExpressions(q))?this._fetchAttributesAsync(b,l,q):this._fetchAttributes(b,l,q);return z([l]).then(n.hitch(this,function(l){return this._getPopupValues(b,l[0])}))}))},getAttachments:function(b){var e=b.getSourceLayer();b=b.attributes;if(this.info.showAttachments&&e&&e.hasAttachments&&e.objectIdField&&(b=b&&b[e.objectIdField]))return e.queryAttachmentInfos(b)},_needFullResolutionFeature:function(b){return(b=b.getSourceLayer())?"function"===typeof b.getMaxAllowableOffset&&
0<b.getMaxAllowableOffset()&&this.hasGeometryOperations():!1},_getFullResolutionFeature:function(b){var e=b.getSourceLayer(),q=e.objectIdField;b=(b=b.attributes)&&q&&b[q];if(null==b)return null;var l=new B;l.where=q+"\x3d"+b;l.maxAllowableOffset=0;l.outFields=[q];e._enableCacheHint(l);return e.queryFeatures(l).then(function(b){return b.features&&b.features[0]})},_isExpressionField:function(b){return this._reExprField.test(b)},_getExprField:function(b){return this._isExpressionField(b)?b.replace(this._reExprField,
""):null},_collectExprField:function(b,e){(b=this._getExprField(b))&&e.push(b);return e},_collectExprFieldsFromTemplatedString:function(b,e){b=this._getExprFieldsFromTemplatedString(b);b.length&&Array.prototype.push.apply(e,b);return e},_getExprFieldsFromTemplatedString:function(b){b=b?b.match(this._reExprFieldPattern):null;return d.map(b,function(b){return b.replace(this._reExprFieldPattern,"$1")},this)},_titleHasAsyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInTitle())},
_contentHasAyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInContent())},_hasAsyncExpressions:function(b){return d.some(b,function(b){b=this._exprCache[b];return!(!b||!b.async)},this)},_compileExpressions:function(b){var e={};d.forEach(b,function(b){var l=b.returnType&&b.returnType.toLowerCase();e[b.name]=new C({expression:b.expression,returnType:"number"===l?"number":"string",profile:w})});return e},_getArcadeExpressions:function(){var b=[],e;for(e in this._exprCache)b.push(this._exprCache[e]);
return b},_fetchAttributesAsync:function(b,e,q){var l=this._fetchAttributes(b,e,q);b={};for(var h in l)(e=l[h])&&e.then&&(b[h]=e);return z(b).then(n.hitch(this,function(b){for(var h in b){var e=b[h];l[h]=e instanceof Error?null:this._processArcadeResult(e)}return l}))},_processArcadeResult:function(b){"string"===typeof b&&(b=g.encode(b));return b},_fetchAttributes:function(b,e,q){var l=n.clone(b.attributes)||{},h=e&&e.geometry,c=this._exprPrefix,k=this._exprCache;q=q||d.map(this.info.expressionInfos,
function(b){return b.name});d.forEach(q,function(e){var q=c+e;e=(e=k[e])?b.evaluateExpression(e,this._getEvalOptions(e,b,h)):null;l[q]=this._processArcadeResult(e)},this);return l},_getEvalOptions:function(b,e,q){var l=b.hasGeometryOperations(),h=e.getSourceLayer(),c=h&&(h.getMap()||h.parentLayer&&h.parentLayer.getMap());b=w.getEvalOptions({expression:b,feature:e,layer:h,map:c,spatialReference:c&&c.spatialReference});e=b.context.vars.$feature;l=!(!l||!q);e&&l&&(e._geometry=q);b.skipCache=l;return b},
_getPopupValues:function(b,e,q){e=e||this._fetchAttributes(b);var l=this.info,h=b.getSourceLayer(),c=n.clone(e),k="",a="",v,g,w,p,r,x=h&&h._getDateOpts&&h._getDateOpts().properties,x=x&&x.slice(0),f={dateFormat:{properties:x,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)},format:null};if(this._relatedInfo)for(p in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(p)){var y=this._relatedInfo[p],A=this._relatedLayersInfo[p];y&&(d.forEach(y.relatedFeatures,function(b){for(r in b.attributes)if(b.attributes.hasOwnProperty(r)&&
"esriRelCardinalityOneToOne"===A.relation.cardinality){var l=this._toRelatedFieldName([A.relation.id,r]);e[l]=c[l]=b.attributes[r]}},this),d.forEach(y.relatedStatsFeatures,function(b){for(r in b.attributes)if(b.attributes.hasOwnProperty(r)){var l=this._toRelatedFieldName([A.relation.id,r]);e[l]=c[l]=b.attributes[r]}},this))}for(g in c)p=this._fieldsMap[g.toLowerCase()],y=this._getLayerFieldInfo(h,g),p&&y&&(p.fieldName=y.name),c[g]=this._formatValue(c[g],g,f),x&&p&&p.format&&p.format.dateFormat&&(p=
d.indexOf(x,g),-1<p&&x.splice(p,1));if(h)for(g in x=h.typeIdField,e)e.hasOwnProperty(g)&&-1===g.indexOf(this._relatedFieldPrefix)&&(w=e[g],u.isDefined(w)&&(p=this._getDomainName(h,b,g,w),u.isDefined(p)?c[g]=p:g===x&&(p=this._getTypeName(h,b,w),u.isDefined(p)&&(c[g]=p))));l.title&&(k=this._processFieldsInLinks(this._fixTokens(l.title,h),e),k=n.trim(this._removeEmptyHref(u.substitute(c,k,f)||"")));if(q)return{title:k};l.description&&(a=this._processFieldsInLinks(this._fixTokens(l.description,h),e),
a=n.trim(this._removeEmptyHref(u.substitute(c,a,f)||"")));l.fieldInfos&&(v=[],d.forEach(l.fieldInfos,function(b){(g=b.fieldName)&&b.visible&&v.push([this._fieldLabels[g.toLowerCase()]||g,u.substitute(c,"${"+g+"}",f)||""])},this));var t,m;l.mediaInfos&&(t=[],d.forEach(l.mediaInfos,function(b){m=0;w=b.value;switch(b.type){case "image":var l=w.sourceURL,l=l&&n.trim(this._removeEmptyHref(u.substitute(e,this._fixTokens(l,h))));m=!!l;break;case "piechart":case "linechart":case "columnchart":case "barchart":var q,
l=w.normalizeField;w.fields=d.map(w.fields,function(b){return(q=this._getLayerFieldInfo(h,b))?q.name:b},this);l&&(q=this._getLayerFieldInfo(h,l),w.normalizeField=q?q.name:l);m=d.some(w.fields,function(b){return u.isDefined(e[b])||-1!==b.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(m){b=n.clone(b);w=b.value;var l=b.title?this._processFieldsInLinks(this._fixTokens(b.title,h),e):"",k=b.caption?this._processFieldsInLinks(this._fixTokens(b.caption,h),e):"";b.title=
l?n.trim(this._removeEmptyHref(u.substitute(c,l,f)||"")):"";b.caption=k?n.trim(this._removeEmptyHref(u.substitute(c,k,f)||"")):"";if("image"===b.type)w.sourceURL=u.substitute(e,this._fixTokens(w.sourceURL,h)),w.linkURL&&(w.linkURL=n.trim(u.substitute(e,this._fixTokens(w.linkURL,h))||""));else{var E,a;d.forEach(w.fields,function(b,l){if(-1!==b.indexOf(this._relatedFieldPrefix))a=this._getRelatedChartInfos(b,w,e,f),a instanceof Array?w.fields=a:w.fields[l]=a;else{var h=e[b],h=void 0===h?null:h;E=e[w.normalizeField]||
0;h&&E&&(h/=E);w.fields[l]={y:h,tooltip:(this._fieldLabels[b.toLowerCase()]||b)+":\x3cbr/\x3e"+this._formatValue(h,b,f,!!E)}}},this)}t.push(b)}},this));return{title:k,description:a,hasDescription:!!l.description,fields:v&&v.length?v:null,mediaInfos:t&&t.length?t:null,formatted:c,editSummary:!1!==l.showLastEditInfo&&h&&h.getEditSummary?h.getEditSummary(b):""}},_getRelatedChartInfos:function(b,e,q,l){var h,c,k,a,v,w;h=[];w=this._fromRelatedFieldName(b);v=w[0];c=this._relatedInfo[v];v=this._relatedLayersInfo[v];
c&&d.forEach(c.relatedFeatures,function(c){c=c.attributes;var E,v;for(v in c)if(c.hasOwnProperty(v)&&v===w[1]){E={};a=c[v];e.normalizeField&&(k=-1!==e.normalizeField.indexOf(this._relatedFieldPrefix)?c[this._fromRelatedFieldName(e.normalizeField)[1]]:q[e.normalizeField]);a&&k&&(a/=k);if(e.tooltipField)if(-1!==e.tooltipField.indexOf(this._relatedFieldPrefix)){var g=this._fromRelatedFieldName(e.tooltipField)[1],p=u.isDefined(c[g])?this._formatValue(c[g],e.tooltipField,l,!!k):g;E.tooltip=p+":\x3cbr/\x3e"+
this._formatValue(a,g,l,!!k)}else E.tooltip=(this._fieldLabels[b.toLowerCase()]||b)+":\x3cbr/\x3e"+this._formatValue(a,e.tooltipField,l,!!k);else E.tooltip=a;E.y=a;h.push(E)}},this);return"esriRelCardinalityOneToMany"===v.relation.cardinality||"esriRelCardinalityManyToMany"===v.relation.cardinality?h:h[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",longMonthDayYearShortTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longMonthDayYearShortTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longMonthDayYearLongTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longMonthDayYearLongTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",
dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",dayShortMonthYearShortTime:"(datePattern: 'd MMM y', timePattern: 'h:mm a', selector: 'date and time')",dayShortMonthYearShortTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm', selector: 'date and time')",dayShortMonthYearLongTime:"(datePattern: 'd MMM y', timePattern: 'h:mm:ss a', selector: 'date and time')",dayShortMonthYearLongTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm:ss', selector: 'date and time')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",
longDateShortTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longDateShortTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longDateLongTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longDateLongTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"},_dateFormatsJson:{shortDate:{datePattern:"M/d/y",selector:"date"},shortDateShortTime:{datePattern:"M/d/y",timePattern:"h:mm a",selector:"date and time"},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",selector:"date and time"},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",selector:"date and time"},shortDateLE:{datePattern:"d/M/y",selector:"date"},
shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",selector:"date and time"},shortDateLEShortTime24:{datePattern:"d/M/y",timePattern:"H:mm",selector:"date and time"},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",selector:"date and time"},longMonthDayYear:{datePattern:"MMMM d, y",selector:"date"},longMonthDayYearShortTime:{datePattern:"MMMM d, y",timePattern:"h:mm a",selector:"date and time"},
longMonthDayYearShortTime24:{datePattern:"MMMM d, y",timePattern:"H:mm",selector:"date and time"},longMonthDayYearLongTime:{datePattern:"MMMM d, y",timePattern:"h:mm:ss a",selector:"date and time"},longMonthDayYearLongTime24:{datePattern:"MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},dayShortMonthYear:{datePattern:"d MMM y",selector:"date"},dayShortMonthYearShortTime:{datePattern:"d MMM y",timePattern:"h:mm a",selector:"date and time"},dayShortMonthYearShortTime24:{datePattern:"d MMM y",
timePattern:"H:mm",selector:"date and time"},dayShortMonthYearLongTime:{datePattern:"d MMM y",timePattern:"h:mm:ss a",selector:"date and time"},dayShortMonthYearLongTime24:{datePattern:"d MMM y",timePattern:"H:mm:ss",selector:"date and time"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},longDateShortTime:{datePattern:"EEEE, MMMM d, y",timePattern:"h:mm a",selector:"date and time"},longDateShortTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm",selector:"date and time"},longDateLongTime:{datePattern:"EEEE, MMMM d, y",
timePattern:"h:mm:ss a",selector:"date and time"},longDateLongTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},longMonthYear:{datePattern:"MMMM y",selector:"date"},shortMonthYear:{datePattern:"MMM y",selector:"date"},year:{datePattern:"y",selector:"date"}},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_fixTokens:function(b,e){var c=this;return b.replace(/(\{([^\{\r\n]+)\})/g,function(b,h,q){b=c._getLayerFieldInfo(e,q);return"$"+(b?
"{"+b.name+"}":h)})},_encodeAttributes:function(b){b=n.clone(b)||{};var e,c;for(e in b)(c=b[e])&&"string"===typeof c&&(c=encodeURIComponent(c).replace(/\'/g,"\x26apos;"),b[e]=c);return b},_processFieldsInLinks:function(b,e){var c=this._encodeAttributes(e);e=n.hitch(this,this._addValuesToHref,e,c);b&&(b=b.replace(this._reHref,e).replace(this._reHrefApos,e));return b},_addValuesToHref:function(b,e,c,l){l=l&&n.trim(l);return c=u.substitute(l&&0===l.indexOf("${")?b:e,c)},_getLayerFieldInfo:function(b,
e){return b&&b.getField?b.getField(e):null},_formatValue:function(b,e,c,l){var h=this._fieldsMap[e.toLowerCase()],q=h&&h.format;e=-1!==d.indexOf(c.dateFormat.properties,e);var k="number"===typeof b&&!e&&(!q||!q.dateFormat);if(!u.isDefined(b)||!h||!u.isDefined(q))return this._applyFormatting(b,k);var a,h=q.hasOwnProperty("places")||q.hasOwnProperty("digitSeparator"),w=q.hasOwnProperty("digitSeparator")?q.digitSeparator:!0;if(h&&!e)a={formatType:"NumberFormat",places:u.isDefined(q.places)&&(!l||0<q.places)?
Number(q.places):Infinity};else if(q.dateFormat)a=n.mixin({formatType:"DateFormat",utcOffset:this.utcOffset},this._dateFormatsJson[q.dateFormat]||this._dateFormatsJson.shortDateShortTime);else return this._applyFormatting(b,k);var g=this._applyFormatFunctions(b,a,c);h&&-1<b.constructor.toString().indexOf("Array")&&(g="",d.forEach(b,n.hitch(this,function(b,l){l&&(g+=" ");g+=this._applyFormatFunctions(b,a,c)})));h&&!w&&v.group&&(g=g.replace(new RegExp("\\"+v.group,"g"),""));e&&(g='\x3cspan class\x3d"esriDateValue"\x3e'+
g+"\x3c/span\x3e");return this._applyFormatting(g,k)},_applyFormatFunctions:function(b,e,c){e&&c&&(c.format={myKey:e});b=u.substitute({myKey:b},"${myKey}",c)||"";e&&c&&(c.format=null);return b},_applyFormatting:function(b,e){return e?this._forceLTR(b):this._applyPreWrap(b)},_forceLTR:function(b){var e=A("ie");return e&&10>=e?b:"\x3cspan class\x3d'esriNumericValue'\x3e"+b+"\x3c/span\x3e"},_applyPreWrap:function(b){return"string"===typeof b?b.replace(this._reNewline,"\x3cspan class\x3d'charNewLine'\x3e$1\x3c/span\x3e"):
b},_insertOffset:function(b){b&&(b=u.isDefined(this.utcOffset)?b.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):b);return b},_getDomainName:function(b,e,c,l){return(b=b.getDomain&&b.getDomain(c,{feature:e}))&&b.codedValues?b.getName(l):null},_getTypeName:function(b,e,c){return(b=b.getType&&b.getType(e))&&b.name},_getRelatedRecords:function(b){var e=b.graphic,c;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=this._getRelatedLayersInfo(b).then(n.hitch(this,function(b){for(c in b)b.hasOwnProperty(c)&&
b[c]&&(this._relatedLayersInfo[c].relatedLayerInfo=b[c])})));return this._relatedLayersInfoPromise.then(n.hitch(this,function(){return this._queryRelatedLayers(e)})).then(n.hitch(this,function(b){this._setRelatedRecords(e,b);return b}))},_getRelatedLayersInfo:function(b){var e=b.fieldsInfo,q,l,h={};q=b.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});d.forEach(e,function(b){var l,h,e,k;l=this._fromRelatedFieldName(b.fieldName);h=l[0];l=l[1];h&&(!this._relatedLayersInfo[h]&&
q&&q.relationships&&(d.some(q.relationships,function(b){if(b.id==h)return k=b,!0}),k&&(this._relatedLayersInfo[h]={relation:k,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[h]&&(this._relatedLayersInfo[h].relatedFields.push(l),b.statisticType&&(e=new c,e.statisticType=b.statisticType,e.onStatisticField=l,e.outStatisticFieldName=l,this._relatedLayersInfo[h].outStatistics.push(e))))},this);for(l in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(l)&&this._relatedLayersInfo[l]&&
(b=this._relatedLayersInfo[l].relation,b=q.url.replace(/[0-9]+$/,b.relatedTableId),this._relatedLayersInfo[l].relatedLayerUrl=b,h[l]=y({url:b,content:{f:"json"},callbackParamName:"callback"}));return p(h)},_queryRelatedLayers:function(b){var e={},c;for(c in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(c)&&(e[c]=this._queryRelatedLayer({graphic:b,relatedInfo:this._relatedLayersInfo[c]}));return p(e)},_queryRelatedLayer:function(b){var e,c,l,h,k,a,v,g,w,x,f,y,u;e=b.graphic;c=e.getSourceLayer();
l=c.url.match(/[0-9]+$/g)[0];f=b.relatedInfo;x=f.relatedLayerInfo;y=f.relatedLayerUrl;b=f.relation;d.some(x.relationships,function(b){if(b.relatedTableId===parseInt(l,10))return h=b,!0},this);h&&(k=new B,d.some(x.fields,function(b){if(b.name===h.keyField)return g=-1!==d.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],b.type)?"number":"string",!0}),h.relationshipTableId&&h.keyFieldInRelationshipTable?(u=new r,this._queryRelatedRecords(e,h).then(n.hitch(this,
function(b){var l;(l=b[e.attributes[c.objectIdField]])?(b=d.map(l.features,function(b){return b.attributes[x.objectIdField]},this),f.outStatistics&&0<f.outStatistics.length&&x.supportsStatistics&&(w=new B,w.where=this._chunkWhereInClause(x.objectIdField,b,1E3),w.outFields=k.outFields,w.outStatistics=f.outStatistics),w&&(a=new G(y),a.execute(w).then(n.hitch(this,function(b){var h=[];h.push(l);h.push(b);u.resolve(h)})))):u.resolve()}))):(v="string"===g?h.keyField+"\x3d'"+e.attributes[b.keyField]+"'":
h.keyField+"\x3d"+e.attributes[b.keyField],k.where=v,k.outFields=f.relatedFields,f.outStatistics&&0<f.outStatistics.length&&x.supportsStatistics&&(w=new B,w.where=k.where,w.outFields=k.outFields,w.outStatistics=f.outStatistics),a=new G(y),v=[],v.push(a.execute(k)),w&&v.push(a.execute(w))));return v?p(v):u?u.promise:void 0},_setRelatedRecords:function(b,e){this._relatedInfo=[];for(var c in e)e.hasOwnProperty(c)&&e[c]&&(b=e[c],this._relatedInfo[c]={},this._relatedInfo[c].relatedFeatures=b[0].features,
u.isDefined(b[1])&&(this._relatedInfo[c].relatedStatsFeatures=b[1].features))},_handlerErrorResponse:function(b,c){b.reject(c)},_fromRelatedFieldName:function(b){var c=[];-1!==b.indexOf(this._relatedFieldPrefix)&&(b=b.split("/"),c=b.slice(1));return c},_toRelatedFieldName:function(b){var c="";b&&0<b.length&&(c=this._relatedFieldPrefix+b[0]+"/"+b[1]);return c},_queryRelatedRecords:function(b,c){var e=b.getSourceLayer(),l=new k;l.outFields=["*"];l.relationshipId=c.id;l.objectIds=[b.attributes[e.objectIdField]];
return e.queryRelatedFeatures(l)},_removeEmptyHref:function(b){return b.replace(/href=(""|'')/gi,"")},_chunkWhereInClause:function(b,c,k){for(var l=0,h=[];l<c.length;)h.push(b+" IN ("+c.slice(l,k+l)+")"),l+=k;return h.join(" OR ")}});a("extend-esri")&&(D.PopupInfo=D.PopupInfoTemplate=m);return m})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(m){var n=m.getObject("dojox.html.entities",!0),d=function(f,a){var r,d;if(a._encCache&&a._encCache.regexp&&a._encCache.mapper&&a.length==
a._encCache.length)r=a._encCache.mapper,d=a._encCache.regexp;else{r={};d=["["];var p;for(p=0;p<a.length;p++)r[a[p][0]]="\x26"+a[p][1]+";",d.push(a[p][0]);d.push("]");d=new RegExp(d.join(""),"g");a._encCache={mapper:r,regexp:d,length:a.length}}return f=f.replace(d,function(a){return r[a]})},t=function(f,a){var r,d;if(a._decCache&&a._decCache.regexp&&a._decCache.mapper&&a.length==a._decCache.length)r=a._decCache.mapper,d=a._decCache.regexp;else{r={};d=["("];var p;for(p=0;p<a.length;p++){var g="\x26"+
a[p][1]+";";p&&d.push("|");r[g]=a[p][0];d.push(g)}d.push(")");d=new RegExp(d.join(""),"g");a._decCache={mapper:r,regexp:d,length:a.length}}return f=f.replace(d,function(a){return r[a]})};n.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];n.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac",
"not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7",
"Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1",
"aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb",
"ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],
["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1",
"thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203",
"exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],
["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],
["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];n.encode=function(f,a){f&&(a?f=d(f,a):(f=d(f,n.html),f=d(f,n.latin)));return f};n.decode=function(d,a){d&&(a?d=t(d,a):(d=t(d,n.html),d=t(d,n.latin)));return d};
return n})},"esri/ArcadeExpression":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./layers/support/attributeUtils ./support/expressionUtils".split(" "),function(m,n,d,t,f,a){m=m(null,{declaredClass:"esri.ArcadeExpression",expression:null,profile:null,returnType:null,async:null,id:null,syntaxTree:null,_traits:null,_attributeDef:null,_attributeCache:null,_compiled:!1,constructor:function(a){n.mixin(this,a);this.returnType=this.returnType||"string";this.id=f.getAttributeId(this.expression);
this._setSyntaxTree(this.profile.parse(this));this.async=this.async||this.profile.isAsync(this)},hasGeometryOperations:function(){var d=this._traits.geometryOperations;void 0===d&&(d=this._traits.geometryOperations=a.hasGeometryOperations(this.syntaxTree));return d},hasFeatureSetOperations:function(){var d=this._traits.featureSetOperations;void 0===d&&(d=this._traits.featureSetOperations=a.hasFeatureSetOperations(this.syntaxTree));return d},hasVariable:function(d){var f=this._traits.variables;void 0===
f[d]&&(f[d]=a.hasVariable(this.syntaxTree,d));return f[d]},hasFunction:function(d){var f=this._traits.functions;void 0===f[d]&&(f[d]=a.hasFunction(this.syntaxTree,d));return f[d]},evaluate:function(d){this._compile();var f=this._attributeCache.compiledFunc;return this.async?a.executeAsyncFunction(f,d):a.executeFunction(f,d)},_setSyntaxTree:function(a){this.syntaxTree=a;this._compiled=!1;this._traits={variables:{},functions:{}};this._createLegacyValueObjects()},_createLegacyValueObjects:function(){this._attributeDef=
{valueExpression:this.expression};this._attributeCache={attributeInfo:this._attributeDef,isNumeric:"number"===this.returnType,idSource:this.expression,id:this.id,hasExpr:!0,compiledFunc:null,syntaxTree:this.syntaxTree,isScaleDriven:!1,dependsOnView:this.hasVariable("$view"),dependsOnGeometry:this.hasGeometryOperations(),isJSFunc:!1}},_compile:function(){this._compiled||(this._attributeCache.compiledFunc=this.profile.compile(this),this._compiled=!0)}});d("extend-esri")&&(t.ArcadeExpression=m);return m})},
"esri/tasks/QueryTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/DeferredList ../kernel ../sniff ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(m,n,d,t,f,a,r,A,p,g,u,D,y,z,C){var B=p("esri-pbf"),G=n(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(c){this._handleSuccess=
d.hitch(this,this._handleSuccess);this._handleError=d.hitch(this,this._handleError);d.mixin(this,c);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var c=new f(this._canceler);this._fetchDfd=c;this._result=null;this._sendRequest();return c.promise},_canceler:function(c){var k=c._pendingRequest,a;c.isFulfilled()||!k||k.isFulfilled()||(k.cancel(),a=k.results&&k.results[1]);c._pendingRequest=null;return a},_sendRequest:function(c){var k=this.query;
this.pagination&&(this._startPage=k.resultOffset=null==c?0:c,k.resultRecordCount=this.pageSize);c=this.requestOptions;this._fetchDfd._pendingRequest=g({url:this.url,content:k,handleAs:"pbf"===k.f?"arraybuffer":"json",callbackParamName:"callback",timeout:c&&c.timeout},c);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},_handleSuccess:function(c){this.pagination?(c.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=
this._result.features.concat(c.features):this._result=c,this._fetchDfd.progress(c),c.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(c),this._fetchDfd.resolve(c))},_handleError:function(c){this._fetchDfd.reject(c)}}),k=n(z,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(c,k){this._handler=
d.hitch(this,this._handler);this._relationshipQueryHandler=d.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=d.hitch(this,this._executeForIdsHandler);this._countHandler=d.hitch(this,this._countHandler);this._extentHandler=d.hitch(this,this._extentHandler);this.source=k&&k.source;this.gdbVersion=k&&k.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,
p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(c,w,p,v,b){var e=b.assembly;c=this._encode(d.mixin({},this._url.query,{f:v&&v.format||"json"},c.toJson(e&&e[0])));var q=this._handler,
l=this._errorHandler;this.source&&(v={source:this.source.toJson()},c.layer=a.toJson(v));this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var h="pbf"===c.f;if(h){var E;B||(E="QueryTask.execute: 'pbf' format is not supported in your browser.");if(E)return c=new f,c.addErrback(function(h){l(h,p,b.dfd)}),c.reject(Error(E)),c}E=this.requestOptions;E=g({url:this._url.path+"/query",content:c,callbackParamName:"callback",handleAs:h?"arraybuffer":"json",timeout:E&&E.timeout},E);c=[E];h&&c.push(k.loadPBFReader());
(new r(c)).then(function(c){b.dfd.isFulfilled()||(c=c[0],c[0]?q(c[1],h,w,p,b.dfd):l(c[1],p,b.dfd))});return E},rawExecute:function(c,k,g){k=k||{};c=this._encode(d.mixin({},this._url.query,{f:k.format||"json"},c.toJson(g.assembly&&g.assembly[0])));this.source&&(c.layer=a.toJson({source:this.source.toJson()}));this.gdbVersion&&(c.gdbVersion=this.gdbVersion);return(new G({url:this._url.path+"/query",query:c,requestOptions:this.requestOptions,pagination:k.pagination,pageSize:k.pageSize})).execute().then(null,
null,function(c){g.dfd.progress(c)}).then(d.hitch(this,function(c){this._successHandler([c],"onRawExecuteComplete",null,g.dfd)})).otherwise(d.hitch(this,function(c){this._errorHandler(c,null,g.dfd)}))},executeRelationshipQuery:function(c,k,a){c=this._encode(d.mixin({},this._url.query,{f:"json"},c.toJson()));var v=this._relationshipQueryHandler,b=this._errorHandler;this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var e=new f(u._dfdCanceller),q=this.requestOptions,l=this._url.path;this.source&&void 0!==
this.source.mapLayerId&&null!==this.source.mapLayerId&&l.endsWith("/dynamicLayer")&&(l=l.slice(0,-13),l=l+"/"+this.source.mapLayerId);e._pendingDfd=g({url:l+"/queryRelatedRecords",content:c,callbackParamName:"callback",timeout:q&&q.timeout,load:function(b,l){v(b,l,k,a,e)},error:function(l){b(l,a,e)}},q);return e},executeForIds:function(c,k,p,v){var b=v.assembly;c=this._encode(d.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},c.toJson(b&&b[0])));var e=this._executeForIdsHandler,q=this._errorHandler;
this.source&&(b={source:this.source.toJson()},c.layer=a.toJson(b));this.gdbVersion&&(c.gdbVersion=this.gdbVersion);b=this.requestOptions;return g({url:this._url.path+"/query",content:c,callbackParamName:"callback",timeout:b&&b.timeout,load:function(b,h){e(b,h,k,p,v.dfd)},error:function(b){q(b,p,v.dfd)}},b)},executeForCount:function(c,k,p,v){var b=v.assembly;c=this._encode(d.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},c.toJson(b&&b[0])));var e=this._countHandler,q=this._errorHandler;
this.source&&(b={source:this.source.toJson()},c.layer=a.toJson(b));this.gdbVersion&&(c.gdbVersion=this.gdbVersion);b=this.requestOptions;return g({url:this._url.path+"/query",content:c,callbackParamName:"callback",timeout:b&&b.timeout,load:function(b,h){e(b,h,k,p,v.dfd)},error:function(b){q(b,p,v.dfd)}},b)},executeForExtent:function(c,k,p,v){var b=v.assembly;c=this._encode(d.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},c.toJson(b&&b[0])));var e=this._extentHandler,q=
this._errorHandler;this.source&&(b={source:this.source.toJson()},c.layer=a.toJson(b));this.gdbVersion&&(c.gdbVersion=this.gdbVersion);b=this.requestOptions;return g({url:this._url.path+"/query",content:c,callbackParamName:"callback",timeout:b&&b.timeout,load:function(b,h){e(b,h,k,p,v.dfd)},error:function(b){q(b,p,v.dfd)}},b)},_handler:function(c,a,g,v,b){try{c&&a&&(c=k.pbfDeps.optimizedFeatures.convertToFeatureSet(k.pbfDeps.pbfQueryUtils.parsePBFFeatureQuery(c)));var e=new C(c);this._successHandler([e],
"onComplete",g,b)}catch(q){this._errorHandler(q,v,b)}},_relationshipQueryHandler:function(c,k,a,g,b){try{var e=c.geometryType,q=c.spatialReference,l={};t.forEach(c.relatedRecordGroups,function(b){var h={};h.geometryType=e;h.spatialReference=q;h.features=b.relatedRecords;h=new C(h);if(null!=b.objectId)l[b.objectId]=h;else for(var c in b)b.hasOwnProperty(c)&&"relatedRecords"!==c&&(l[b[c]]=h)});this._successHandler([l],"onExecuteRelationshipQueryComplete",a,b)}catch(h){this._errorHandler(h,g,b)}},_executeForIdsHandler:function(c,
k,a,g,b){try{this._successHandler([c.objectIds],"onExecuteForIdsComplete",a,b)}catch(e){this._errorHandler(e,g,b)}},_countHandler:function(c,k,a,g,b){try{var e,q=c.features,l=c.objectIds;if(l)e=l.length;else{if(q)throw Error("Unable to perform query. Please check your parameters.");e=c.count}this._successHandler([e],"onExecuteForCountComplete",a,b)}catch(h){this._errorHandler(h,g,b)}},_extentHandler:function(c,k,a,g,b){try{c.extent&&(c.extent=new D(c.extent)),this._successHandler([c],"onExecuteForExtentComplete",
a,b)}catch(e){this._errorHandler(e,g,b)}}});k.loadPBFReader=function(){var c=new f;k.pbfDeps?c.resolve():m(["./support/pbfDeps"],function(a){k.pbfDeps=a;c.isFulfilled()||c.resolve()});return c.promise};y._createWrappers(k);p("extend-esri")&&d.setObject("tasks.QueryTask",k,A);return k})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(m,n,d){m.DeferredList=function(t,f,a,r,m){var p=[];n.call(this);var g=this;0!==t.length||f||this.resolve([0,[]]);
var u=0;d.forEach(t,function(d,y){function n(a,d){p[y]=[a,d];u++;u===t.length&&g.resolve(p)}d.then(function(a){f?g.resolve([y,a]):n(!0,a)},function(d){a?g.reject(d):n(!1,d);if(r)return null;throw d;})})};m.DeferredList.prototype=new n;m.DeferredList.prototype.gatherResults=function(n){n=new m.DeferredList(n,!1,!0,!1);n.addCallback(function(f){var a=[];d.forEach(f,function(d){a.push(d[1])});return a});return n};return m.DeferredList})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),
function(m,n,d,t,f,a,r,A){m=m(A,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(a,g){a&&n.isString(a)&&(this._url=r.urlToObject(this.url=a));g&&g.requestOptions&&(this.requestOptions=g.requestOptions);this.normalization=!0;this._errorHandler=n.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var a=this._url,g=/^http:/i;this.url&&(this.url=this.url.replace(g,"https:"));a&&a.path&&(a.path=a.path.replace(g,"https:"))},
_encode:function(a,g,f){var p,y,u={},r,t;for(r in a)if("declaredClass"!==r&&(p=a[r],y=typeof p,null!==p&&void 0!==p&&"function"!==y))if(n.isArray(p))for(u[r]=[],t=p.length,y=0;y<t;y++)u[r][y]=this._encode(p[y]);else"object"===y?p.toJson&&(y=p.toJson(f&&f[r]),"esri.tasks.FeatureSet"===p.declaredClass&&y.spatialReference&&(y.sr=y.spatialReference,delete y.spatialReference),u[r]=g?y:d.toJson(y)):u[r]=p;return u},_successHandler:function(d,g,f,n){g&&this[g].apply(this,d);f&&f.apply(null,d);n&&a._resDfd(n,
d)},_errorHandler:function(a,g,d){this.onError(a);g&&g(a);d&&d.errback(a)},setNormalization:function(a){this.normalization=a},onError:function(){}});t("extend-esri")&&(f.Task=m);return m})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(m,n,d,t,f,a,r,A,p,g,u,D){m=m(null,{declaredClass:"esri.tasks.FeatureSet",
constructor:function(a,g){if(a){n.mixin(this,a);var p=this.features=this.features||[],f=a.spatialReference,f=this.spatialReference=u.createInstance(A.simpleConstructor,f),y=u.getGeometryType(a.geometryType);this.geometryType=a.geometryType;a.fields&&(this.fields=a.fields);a=u.supportsLazyUnquantization(this.geometryType);var k=u.unquantizeFunction(this.geometryType,this.transform),c=!!(g&&a&&k),w=y&&(c?y.accessorConstructor:y.simpleConstructor);d.forEach(p,function(a,d){var b=u.createInstance(r.simpleConstructor),
e=a.geometry;if(y&&e){var q=b.geometry=u.createInstance(w,c?null:e);q.setSpatialReference(e.spatialReference?u.createInstance(A.simpleConstructor,e.spatialReference):f);c&&q.setupLazyUnquantization(k,e)}b.symbol=a.symbol?D.fromJson(a.symbol):null;b.attributes=a.attributes;p[d]=b});c||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(d){var g={};this.displayFieldName&&(g.displayFieldName=this.displayFieldName);this.fields&&
(g.fields=this.fields);this.spatialReference?g.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(g.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(g.geometryType=u.getJsonType(this.features[0].geometry)),g.features=p._encodeGraphics(this.features,d));g.geometryType=g.geometryType||this.geometryType;g.exceededTransferLimit=this.exceededTransferLimit;g.transform=this.transform;return a.fixJson(g)},
_hydrate:function(){u.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=null,this;var g=a.translate[0],d=a.translate[1],p=a.scale[0],f=a.scale[1],k=this.features,c=function(b,c,k){var l,h,e,a,q,g,d=[];l=0;for(h=b.length;l<h;l++)if(e=b[l],0<l){if(g=c(e[0]),e=k(e[1]),g!==a||e!==q)d.push([g-a,e-q]),a=g,q=e}else a=c(e[0]),q=k(e[1]),d.push([a,q]);return 0<d.length?d:null},w=function(b,e,k){if("esriGeometryPoint"===
b)return function(b){b.x=e(b.x);b.y=k(b.y);return b};if("esriGeometryPolyline"===b||"esriGeometryPolygon"===b)return function(b){var h,l,a,q,g;a=b.rings||b.paths;g=[];h=0;for(l=a.length;h<l;h++)q=a[h],(q=c(q,e,k))&&g.push(q);return 0<g.length?(b.rings?b.rings=g:b.paths=g,b):null};if("esriGeometryMultipoint"===b)return function(b){var h;h=c(b.points,e,k);return 0<h.length?(b.points=h,b):null};if("esriGeometryEnvelope"===b)return function(b){return b}}(this.geometryType,function(b){return Math.round((b-
g)/p)},function(b){return Math.round((d-b)/f)}),n,v;n=0;for(v=k.length;n<v;n++)k[n].geometry&&(w(k[n].geometry)||k[n].setGeometry(null));this.transform=a;return this}});m.createGraphics=function(a){var g=a.geometryType,p=u.createInstance(A.simpleConstructor,a.spatialReference),f=u.getGeometryType(g).accessorConstructor,n=u.unquantizeFunction(g,a.transform);return d.map(a.features,function(k,c){c=u.createInstance(r.simpleConstructor);var a=k.geometry;if(a){var g=c.geometry=u.createInstance(f);g.setSpatialReference(p);
g.setupLazyUnquantization(n,a)}c.attributes=k.attributes;return c})};m.createPolygon=function(a,d,p){var f;a&&(f=u.createInstance(g.accessorConstructor),f.setSpatialReference(d),d=u.unquantizeFunction("esriGeometryPolygon",p),f.setupLazyUnquantization(d,a));return f};t("extend-esri")&&n.setObject("tasks.FeatureSet",m,f);return m})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(m,n,d,t,f){m=m(null,{declaredClass:"esri.tasks.RelationshipQuery",
definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,orderByFields:null,toJson:function(){var a={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},f=this.objectIds,n=this.outFields,p=this.outSpatialReference,g=this.orderByFields;f&&(a.objectIds=f.join(","));n&&(a.outFields=n.join(","));
p&&(a.outSR=p.wkid||d.toJson(p.toJson()));g&&(a.orderByFields=g.join(","));a._ts=this._ts;return a}});t("extend-esri")&&n.setObject("tasks.RelationshipQuery",m,f);return m})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,n,d,t){m=m(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,
maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});d("extend-esri")&&n.setObject("tasks.StatisticDefinition",m,t);return m})},"esri/arcadeProfiles/popupProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(m,n,d,t,f,a,r,A){m=new (m(null,{declaredClass:"esri.arcadeProfiles.PopupProfile",defaults:{globals:{featureSet:["$layer","$datastore",
"$map"],async:["$layer","$datastore","$map"]},context:{vars:{$feature:"any",$layer:"any",$datastore:"any",$map:"any"}}},initialize:function(a){var g=[];A.hasGeometryOperations(a)&&g.push(r.enableGeometryOperations());(A.hasFeatureSetOperations(a)||A.hasVariables(a,this.defaults.globals.featureSet))&&g.push(r.enableFeatureSetOperations());A.isAsync(a)&&g.push(r.enableAsyncOperations());return f(g)},isAsync:function(a){a=[a];return A.hasFeatureSetOperations(a)||A.hasVariables(a,this.defaults.globals.async)},
parse:function(a){return r.createSyntaxTree(a.expression)},compile:function(a){var g=n.clone(this.defaults.context);g.useAsync=a.async;return a.syntaxTree?r.createFunction(a.syntaxTree,g):null},getEvalOptions:function(d){var g=d.expression,f=d.feature,p=d.layer,n=d.map;d=d.spatialReference;var f=f&&g.hasVariable("$feature")?a.createFromGraphicLikeObject(f.geometry,f.attributes,p):null,t,m;if(p){var B={spatialReference:d};g.hasVariable("$layer")&&(t=p.getMap()?r.createFeatureSetFromLayer(p,B):r.createFeatureSetFromLayerUrl(p.url,
B));g.hasVariable("$datastore")&&(m=(m=A.getServiceUrl(p.url))?r.createFeatureSetCollectionFromServiceUrl(m,B):null)}g=n&&g.hasVariable("$map")?r.createFeatureSetCollectionFromMap(n):null;return{context:{vars:{$feature:f,$layer:t,$datastore:m,$map:g},spatialReference:d}}}}));d("extend-esri")&&n.setObject("arcadeProfiles.popupProfile",m,t);return m})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(m,n,d,t,f,a,r,A,p,g,u,D,y,z,C,B,G,k,c,w,x){var v=0,b=x.widgets.popup,e=x.widgets.templatePicker;n=n([w,C,B],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=t.mixin({},b)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'statusSection hidden' dojoAttachPoint\x3d'_status'\x3e\x3c/div\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this._showStatus(e.loading);this._contentDfd=this.template.getComponents(this.graphic).then(t.hitch(this,this._handleComponentsSuccess)).otherwise(t.hitch(this,this._handleComponentsError))},destroy:function(){this._contentDfd&&this._contentDfd.cancel();this._attachmentsDfd&&this._attachmentsDfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._contentDfd=this._attachmentsDfd=null;this.inherited(arguments)},
_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var b=this._mediaInfos,l=b.length,h=this.domNode,c=this._prevMedia,e=this._nextMedia;if(1<l){var k=0,d=0;f.forEach(b,function(b){"image"===b.type?k++:-1!==b.type.indexOf("chart")&&d++});k&&(g.set(this._imageCount,"innerHTML",k),a.query(".summary .image",
h).removeClass("hidden"));d&&(g.set(this._chartCount,"innerHTML",d),a.query(".summary .chart",h).removeClass("hidden"))}else a.query(".summary",h).addClass("hidden"),u.add(c,"hidden"),u.add(e,"hidden");b=this._mediaPtr;0===b?u.add(c,"hidden"):u.remove(c,"hidden");b===l-1?u.add(e,"hidden"):u.remove(e,"hidden");this._destroyFrame()},_displayMedia:function(){var b=this._mediaInfos[this._mediaPtr],l=b.title,h=b.caption,c=a.query(".mediaSection .hzLine",this.domNode)[0];g.set(this._mediaTitle,"innerHTML",
l);u[l?"remove":"add"](this._mediaTitle,"hidden");g.set(this._mediaCaption,"innerHTML",h);u[h?"remove":"add"](this._mediaCaption,"hidden");u[l&&h?"remove":"add"](c,"hidden");this._rid=null;if("image"===b.type)this._showImage(b);else{var e=this,l=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],h=b.value.theme||this.chartTheme;t.isString(h)&&(h=h.replace(/\./gi,"/"),-1===h.indexOf("/")&&(h="dojox/charting/themes/"+h));h||(h="./Rainbow");l.push(h);try{var k=this._rid=v++;m(l,function(h,
l,c){k===e._rid&&(e._rid=null,e._showChart(b.type,b.value,h,l,c))})}catch(N){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(b){return(b=b&&t.trim(b).toLowerCase())&&(0===b.indexOf("mailto:")||0===b.indexOf("tel:"))},_showImage:function(b){u.add(this._mediaFrame,"image");var l=y.get(this._gallery,"height"),h=b.value,c=z.decode(h.linkURL),h=z.decode(h.sourceURL),e;c&&(e=D.create("a",{href:c,target:this._preventNewTab(c)?"":"_blank"},this._mediaFrame));c=b.refreshInterval?
this._addURLParameter(h,"timestamp",Date.now()):h;D.create("img",{className:"esriPopupMediaImage",src:c},e||this._mediaFrame);var k=a.query(".esriPopupMediaImage",this._mediaFrame)[0];this._imageLoadHandle=d.connect(k,"onload",this,function(){this._clearImageHandles();this._imageLoaded(k,l);this._initImageRefresh(b)})},_addURLParameter:function(b,l,h){var c=-1===b.indexOf("?")?"?":"\x26";return b+c+l+"\x3d"+h},_initImageRefresh:function(b){if(b.refreshInterval){var l=6E4*b.refreshInterval;this._imageRefreshHandle=
setTimeout(t.hitch(this,function(){this._destroyFrame();this._showImage(b)}),l)}},_clearImageHandles:function(){d.disconnect(this._imageLoadHandle);this._imageLoadHandle=null;clearTimeout(this._imageRefreshHandle);this._imageRefreshHandle=null},_showChart:function(b,l,h,c,e){u.remove(this._mediaFrame,"image");h=this._chart=new h(D.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});e&&h.setTheme(e);switch(b){case "piechart":h.addPlot("default",{type:"Pie",labels:!1});h.addSeries("Series A",
l.fields);break;case "linechart":h.addPlot("default",{type:"Markers"});h.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});h.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});f.forEach(l.fields,function(b,h){b.x=h+1});h.addSeries("Series A",l.fields);break;case "columnchart":h.addPlot("default",{type:"Columns",gap:3});h.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});h.addSeries("Series A",l.fields);break;case "barchart":h.addPlot("default",{type:"Bars",
gap:3}),h.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),h.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),h.addSeries("Series A",l.fields)}this._action=new c(h);h.render()},_destroyFrame:function(){this._rid=null;this._clearImageHandles();this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);g.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(b,c){var h=b.height;h<c&&y.set(b,"marginTop",
Math.round((c-h)/2)+"px")},_attListHandler:function(b,l){if(b===this._attachmentsDfd){this._attachmentsDfd=null;var h="";l instanceof Error||!l||!l.length||f.forEach(l,function(b){h+="\x3cli\x3e";h+="\x3ca href\x3d'"+c.addProxy(b.url)+"' target\x3d'_blank'\x3e"+(b.name||"[No name]")+"\x3c/a\x3e";h+="\x3c/li\x3e"});g.set(this._attachmentsList,"innerHTML",h||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_createLinkIfURI:function(b){var l=c.getURIInfo(b);if(l){var h=b.match(l.pattern);return b.replace(l.pattern,
"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+k.substitute({appName:l.appName,hierPart:h&&h[2]},l.label)+"\x3c/a\x3e")}return b},_showStatus:function(b){g.set(this._status,"innerHTML",b);u.remove(this._status,"hidden");a.query(".mainSection",this.domNode).addClass("hidden")},_hideStatus:function(){g.set(this._status,"innerHTML","");u.add(this._status,"hidden");a.query(".mainSection",this.domNode).removeClass("hidden")},_handleComponentsSuccess:function(c){if(c){this._hideStatus();var l=
this.showTitle?c.title:"",h=c.description,e=c.fields,k=c.mediaInfos,d=this.domNode,q=this._nls,v=this,n=this.template,w=this.graphic;this._prevMedia.title=q.NLS_prevMedia;this._nextMedia.title=q.NLS_nextMedia;g.set(this._title,"innerHTML",l);l||u.add(this._title,"hidden");!c.hasDescription&&e&&(h="",f.forEach(e,function(b){h+="\x3ctr valign\x3d'top'\x3e";h+="\x3ctd class\x3d'attrName'\x3e"+z.encode(b[0])+"\x3c/td\x3e";h+="\x3ctd class\x3d'attrValue'\x3e"+this._createLinkIfURI(b[1])+"\x3c/td\x3e";
h+="\x3c/tr\x3e"},this),h&&(h="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+h+"\x3c/table\x3e"));g.set(this._description,"innerHTML",h);h||u.add(this._description,"hidden");a.query("a",this._description).forEach(function(b){v._preventNewTab(b.href)?"_blank"===b.target&&g.remove(b,"target"):g.set(b,"target","_blank")});l&&h?a.query(".mainSection .hzLine",d).removeClass("hidden"):l||h?a.query(".mainSection .hzLine",d).addClass("hidden"):a.query(".mainSection",d).addClass("hidden");
if(l=this._attachmentsDfd=n.getAttachments(w))l.addBoth(t.hitch(this,this._attListHandler,l)),g.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+q.NLS_searching+"...\x3c/li\x3e"),a.query(".attachmentsSection",d).removeClass("hidden");k&&k.length&&(a.query(".mediaSection",d).removeClass("hidden"),p.setSelectable(this._mediaFrame,!1),this._mediaInfos=k,this._mediaPtr=0,this._updateUI(),this._displayMedia());c.editSummary&&(g.set(this._editSummary,"innerHTML",c.editSummary),k&&k.length&&u.remove(this._mediaBreak,
"hidden"),u.remove(this._editSummarySection,"hidden"));this.emit("content-update")}else this._showStatus(b.NLS_noInfo)},_handleComponentsError:function(c){c&&"cancel"===c.dojoType||(console.log("PopupRenderer: error loading template",c),this._showStatus(b.NLS_noInfo))}});r("extend-esri")&&t.setObject("dijit._PopupRenderer",n,G);return n})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(m,n,d,t,f,a,r,A,p,g,u,D,y){function z(){}function C(a){return function(g,k,c,f){return g&&"string"==typeof k&&g[k]==z?g.on(k.substring(2).toLowerCase(),r.hitch(c,f)):a.apply(d,arguments)}}m.around(d,"connect",C);a.connect&&m.around(a,"connect",C);m=t("dijit._Widget",[u,D,y],{onClick:z,onDblClick:z,onKeyDown:z,onKeyPress:z,onKeyUp:z,onMouseDown:z,onMouseMove:z,onMouseOut:z,onMouseOver:z,onMouseLeave:z,onMouseEnter:z,onMouseUp:z,constructor:function(a){this._toConnect={};for(var g in a)this[g]===
z&&(this._toConnect[g.replace(/^on/,"").toLowerCase()]=a[g],delete a[g])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,g){return this[this._onMap(a)]===z?d.connect(this.domNode,a.toLowerCase(),this,g):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(g,d){a.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(g,d)},attr:function(a,g){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){a.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?A("[widgetId]",this.containerNode).map(g.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});f("dijit-legacy-requires")&&p(0,function(){require(["dijit/_base"])});
return m})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(m,n,d,t,f,a,r,A,p,g,u,D,y,z,C,B,G,k,c,w,x,v,b){function e(b){return function(c){A[c?
"set":"remove"](this.domNode,b,c);this._set(b,c)}}y.add("dijit-legacy-requires",!z.isAsync);y.add("dojo-bidi",!1);y("dijit-legacy-requires")&&G(0,function(){m(["dijit/_base/manager"])});var q={};t=a("dijit._WidgetBase",[k,x],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:e("lang"),dir:"",_setDirAttr:e("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(b){this._set("ownerDocument",
b)},attributeMap:{},_blankGif:t.blankGif||m.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var b=this.constructor;if(!b._setterAttrs){var c=b.prototype,e=b._setterAttrs=[],b=b._onMap={},a;for(a in c.attributeMap)e.push(a);for(a in c)/^on/.test(a)&&(b[a.substring(2).toLowerCase()]=a),/^_set[A-Z](.*)Attr$/.test(a)&&(a=a.charAt(4).toLowerCase()+a.substr(5,a.length-9),c.attributeMap&&a in c.attributeMap||e.push(a))}},postscript:function(b,c){this.create(b,c)},create:function(c,h){this._introspect();
this.srcNodeRef=r.byId(h);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);c&&(this.params=c,C.mixin(this,c));this.postMixInProperties();this.id||(this.id=b.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=w.body(this.ownerDocument);b.add(this);
this.buildRendering();var l;this.domNode&&(this._applyAttributes(),(c=this.srcNodeRef)&&c.parentNode&&this.domNode!==c&&(c.parentNode.replaceChild(this.domNode,c),l=!0),this.domNode.setAttribute("widgetId",this.id));this.postCreate();l&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var b={},c;for(c in this.params||{})b[c]=this._get(c);n.forEach(this.constructor._setterAttrs,function(c){if(!(c in b)){var h=this._get(c);h&&this.set(c,h)}},this);for(c in b)this.set(c,b[c])},postMixInProperties:function(){},
buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var b=this.baseClass.split(" ");this.isLeftToRight()||(b=b.concat(n.map(b,function(b){return b+"Rtl"})));p.add(this.domNode,b)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,n.forEach(this.getChildren(),function(b){b._started||b._destroyed||!C.isFunction(b.startup)||(b.startup(),b._started=!0)}))},destroyRecursive:function(b){this._beingDestroyed=
!0;this.destroyDescendants(b);this.destroy(b)},destroy:function(c){function h(b){b.destroyRecursive?b.destroyRecursive(c):b.destroy&&b.destroy(c)}this._beingDestroyed=!0;this.uninitialize();n.forEach(this._connects,C.hitch(this,"disconnect"));n.forEach(this._supportingWidgets,h);this.domNode&&n.forEach(b.findWidgets(this.domNode,this.containerNode),h);this.destroyRendering(c);b.remove(this.id);this._destroyed=!0},destroyRendering:function(b){this.bgIframe&&(this.bgIframe.destroy(b),delete this.bgIframe);
this.domNode&&(b?A.remove(this.domNode,"widgetId"):g.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(b||g.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(b){n.forEach(this.getChildren(),function(c){c.destroyRecursive&&c.destroyRecursive(b)})},uninitialize:function(){return!1},_setStyleAttr:function(b){var c=this.domNode;C.isObject(b)?D.set(c,b):c.style.cssText=c.style.cssText?c.style.cssText+("; "+b):b;this._set("style",b)},_attrToDom:function(b,c,a){a=3<=
arguments.length?a:this.attributeMap[b];n.forEach(C.isArray(a)?a:[a],function(a){var h=this[a.node||a||"domNode"];switch(a.type||"attribute"){case "attribute":C.isFunction(c)&&(c=C.hitch(this,c));a=a.attribute?a.attribute:/^on[A-Z][a-zA-Z]*$/.test(b)?b.toLowerCase():b;h.tagName?A.set(h,a,c):h.set(a,c);break;case "innerText":h.innerHTML="";h.appendChild(this.ownerDocument.createTextNode(c));break;case "textContent":h.textContent=c;break;case "innerHTML":h.innerHTML=c;break;case "class":p.replace(h,
c,this[b]);break;case "toggleClass":p.toggle(h,a.className||b,c)}},this)},get:function(b){var c=this._getAttrNames(b);return this[c.g]?this[c.g]():this._get(b)},set:function(b,c){if("object"===typeof b){for(var a in b)this.set(a,b[a]);return this}a=this._getAttrNames(b);var h=this[a.s];if(C.isFunction(h))var e=h.apply(this,Array.prototype.slice.call(arguments,1));else{var h=this.focusNode&&!C.isFunction(this.focusNode)?"focusNode":"domNode",k=this[h]&&this[h].tagName,l;if((l=k)&&!(l=q[k])){l=this[h];
var g={},d;for(d in l)g[d.toLowerCase()]=!0;l=q[k]=g}d=l;a=b in this.attributeMap?this.attributeMap[b]:a.s in this?this[a.s]:d&&a.l in d&&"function"!=typeof c||/^aria-|^data-|^role$/.test(b)?h:null;null!=a&&this._attrToDom(b,c,a);this._set(b,c)}return e||this},_attrPairNames:{},_getAttrNames:function(b){var c=this._attrPairNames;if(c[b])return c[b];var a=b.replace(/^[a-z]|-[a-zA-Z]/g,function(b){return b.charAt(b.length-1).toUpperCase()});return c[b]={n:b+"Node",s:"_set"+a+"Attr",g:"_get"+a+"Attr",
l:a.toLowerCase()}},_set:function(b,c){var a=this[b];this[b]=c;!this._created||a===c||a!==a&&c!==c||(this._watchCallbacks&&this._watchCallbacks(b,a,c),this.emit("attrmodified-"+b,{detail:{prevValue:a,newValue:c}}))},_get:function(b){return this[b]},emit:function(b,c,a){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var e,h=this["on"+b];h&&(e=h.apply(this,a?a:[c]));this._started&&!this._beingDestroyed&&B.emit(this.domNode,
b.toLowerCase(),c);return e},on:function(b,c){var a=this._onMap(b);return a?d.after(this,a,c,!0):this.own(B(this.domNode,b,c))[0]},_onMap:function(b){var c=this.constructor,a=c._onMap;if(!a){var a=c._onMap={},e;for(e in c.prototype)/^on/.test(e)&&(a[e.replace(/^on/,"").toLowerCase()]=e)}return a["string"==typeof b&&b.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?b.findWidgets(this.containerNode):
[]},getParent:function(){return b.getEnclosingWidget(this.domNode.parentNode)},connect:function(b,c,a){return this.own(f.connect(b,c,this,a))[0]},disconnect:function(b){b.remove()},subscribe:function(b,a){return this.own(c.subscribe(b,C.hitch(this,a)))[0]},unsubscribe:function(b){b.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():u.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=D.get(this.domNode,"display")},placeAt:function(c,a){var e=
!c.tagName&&b.byId(c);!e||!e.addChild||a&&"number"!==typeof a?(c=e&&"domNode"in e?e.containerNode&&!/after|before|replace/.test(a||"")?e.containerNode:e.domNode:r.byId(c,this.ownerDocument),g.place(this.domNode,c,a),!this._started&&(this.getParent()||{})._started&&this.startup()):e.addChild(this,a);return this},defer:function(b,c){var a=setTimeout(C.hitch(this,function(){a&&(a=null,this._destroyed||C.hitch(this,b)())}),c||0);return{remove:function(){a&&(clearTimeout(a),a=null);return null}}}});y("dojo-bidi")&&
t.extend(v);return t})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(m,n,d){return d("dijit.Destroyable",null,{destroy:function(d){this._destroyed=!0},own:function(){var d=["destroyRecursive","destroy","remove"];m.forEach(arguments,function(f){function a(){t.remove();m.forEach(p,function(a){a.remove()})}var r,t=n.before(this,"destroy",function(a){f[r](a)}),p=[];f.then?(r="cancel",f.then(a,a)):m.forEach(d,function(d){"function"===typeof f[d]&&
(r||(r=d),p.push(n.after(f,d,a,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(m,n,d,t,f,a){m=t("dijit._OnDijitClickMixin",null,{connect:function(d,f,p){return this.inherited(arguments,[d,"ondijitclick"==f?a:f,p])}});m.a11yclick=a;return m})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(m,n,d,t){t.extend(n,
{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return d("dijit._FocusMixin",null,{_focusManager:m})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(m,n,d,t){d(function(){n("highcontrast")&&m.add(t.body(),"dijit_a11y")});return n})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(m,
n,d,t,f,a,r){f.add("highcontrast",function(){var a=r.doc.createElement("div");try{a.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(n.blankGif||m.toUrl("./resources/blank.gif"))+'");';r.body().appendChild(a);var d=t.getComputedStyle(a),g=d.backgroundImage;return d.borderTopColor==d.borderRightColor||g&&("none"==g||"url(invalid-url:)"==g)}catch(u){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
u.toString()),!1}finally{8>=f("ie")?a.outerHTML="":r.body().removeChild(a)}});a(function(){f("highcontrast")&&d.add(r.body(),"dj_a11y")});return f})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(m,n,d,t,f,a,r){a.extend(m,{waiRole:"",waiState:""});return f("dijit._Templated",[n,d],{constructor:function(){r.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(a,d){var g=this.inherited(arguments),f=d(a,"waiRole");f&&a.setAttribute("role",f);(f=d(a,"waiState"))&&t.forEach(f.split(/\s*,\s*/),function(d){-1!=d.indexOf("-")&&(d=d.split("-"),a.setAttribute("aria-"+d[0],d[1]))});return g}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(m,n,d,t,f,a,r,A){var p=n("dijit._TemplatedMixin",A,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(a){var d=this.declaredClass,g=this;return r.substitute(a,this,function(a,f){"!"==f.charAt(0)&&(a=t.getObject(f.substr(1),!1,g));if("undefined"==typeof a)throw Error(d+" template:"+f);return null==a?"":"!"==f.charAt(0)?a:this._escapeValue(""+a)},this)},_escapeValue:function(a){return a.replace(/["'<>&]/g,function(a){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[a]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=m(this.templatePath,{sanitize:!0}));var a=p.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),f;if(t.isString(a)){if(f=d.toDom(this._stringRepl(a),this.ownerDocument),1!=f.nodeType)throw Error("Invalid template: "+a);}else f=a.cloneNode(!0);this.domNode=f}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(a){var d=this.containerNode;if(a&&d)for(;a.hasChildNodes();)d.appendChild(a.firstChild)}});
p._templateCache={};p.getCachedTemplate=function(a,f,n){var g=p._templateCache,t=a,m=g[t];if(m){try{if(!m.ownerDocument||m.ownerDocument==(n||document))return m}catch(B){}d.destroy(m)}a=r.trim(a);if(f||a.match(/\$\{([^\}]+)\}/g))return g[t]=a;f=d.toDom(a,n);if(1!=f.nodeType)throw Error("Invalid template: "+a);return g[t]=f};a("ie")&&f(window,"unload",function(){var a=p._templateCache,f;for(f in a){var n=a[f];"object"==typeof n&&d.destroy(n);delete a[f]}});return p})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(m){return m.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(m,n,d,t,f,a,r,A,p){var g=f.delegate(A,{mouseenter:a.enter,mouseleave:a.leave,keypress:d._keypress}),u;d=t("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(a){for(var d=a;;)if(1==d.nodeType&&(this._processTemplateNode(d,function(a,d){return a.getAttribute(d)},this._attach)||this.searchContainerNode)&&d.firstChild)d=d.firstChild;else{if(d==a)break;for(;!d.nextSibling;)if(d=d.parentNode,d==a)return;d=d.nextSibling}},_processTemplateNode:function(a,d,g){var n=!0,p=this.attachScope||this,t=d(a,"dojoAttachPoint")||d(a,"data-dojo-attach-point");if(t)for(var k=t.split(/\s*,\s*/);t=
k.shift();)f.isArray(p[t])?p[t].push(a):p[t]=a,n="containerNode"!=t,this._attachPoints.push(t);if(d=d(a,"dojoAttachEvent")||d(a,"data-dojo-attach-event"))for(t=d.split(/\s*,\s*/),k=f.trim;d=t.shift();)if(d){var c=null;-1!=d.indexOf(":")?(c=d.split(":"),d=k(c[0]),c=k(c[1])):d=k(d);c||(c=d);this._attachEvents.push(g(a,d,f.hitch(p,c)))}return n},_attach:function(a,d,f){d=d.replace(/^on/,"").toLowerCase();d="dijitclick"==d?u||(u=m("./a11yclick")):g[d]||d;return r(a,d,f)},_detachTemplateNodes:function(){var a=
this.attachScope||this;n.forEach(this._attachPoints,function(d){delete a[d]});this._attachPoints=[];n.forEach(this._attachEvents,function(a){a.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});f.extend(p,{dojoAttachEvent:"",dojoAttachPoint:""});return d})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(m,n,d,t,f){return d("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var a=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);f.parse(a,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(t.hitch(this,function(a){this._startupWidgets=a;for(var d=0;d<a.length;d++)this._processTemplateNode(a[d],
function(a,d){return a[d]},function(a,d,f){return d in a?a.connect(a,d,f):a.on(d,f,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(a,d,f){return d(a,"dojoType")||d(a,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){m.forEach(this._startupWidgets,function(a){a&&!a._started&&a.startup&&a.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(m,n,d,t,f,a,r,A,p,g,u,D,y,z,C,B){function G(c){return eval("("+c+")")}function k(c){var b=
c._nameCaseMap,a=c.prototype;if(!b||b._extendCnt<w){var b=c._nameCaseMap={},k;for(k in a)"_"!==k.charAt(0)&&(b[k.toLowerCase()]=k);b._extendCnt=w}return b}function c(c,b){b||(b=m);var a=b._dojoParserCtorMap||(b._dojoParserCtorMap={}),k=c.join();if(!a[k]){for(var l=[],h=0,g=c.length;h<g;h++){var f=c[h];l[l.length]=a[f]=a[f]||d.getObject(f)||~f.indexOf("/")&&b(f)}c=l.shift();a[k]=l.length?c.createSubclass?c.createSubclass(l):c.extend.apply(c,l):c}return a[k]}new Date("X");var w=0;p.after(d,"extend",
function(){w++},!0);var x={_clearCache:function(){w++;_ctorMap={}},_functionFromScript:function(c,b){var a="",k="",d=c.getAttribute(b+"args")||c.getAttribute("args");b=c.getAttribute("with");d=(d||"").split(/\s*,\s*/);b&&b.length&&t.forEach(b.split(/\s*,\s*/),function(b){a+="with("+b+"){";k+="}"});return new Function(d,a+c.innerHTML+k)},instantiate:function(c,b,a){b=b||{};a=a||{};var e=(a.scope||n._scopeName)+"Type",k="data-"+(a.scope||n._scopeName)+"-",h=k+"type",d=k+"mixins",f=[];t.forEach(c,function(c){var a=
e in b?b[e]:c.getAttribute(h)||c.getAttribute(e);if(a){var k=c.getAttribute(d),a=k?[a].concat(k.split(/\s*,\s*/)):[a];f.push({node:c,types:a})}});return this._instantiate(f,b,a)},_instantiate:function(a,b,e,k){function d(c){b._started||e.noStart||t.forEach(c,function(b){"function"!==typeof b.startup||b._started||b.startup()});return c}a=t.map(a,function(a){var k=a.ctor||c(a.types,e.contextRequire);if(!k)throw Error("Unable to resolve constructor for: '"+a.types.join()+"'");return this.construct(k,
a.node,b,e,a.scripts,a.inherited)},this);return k?g(a).then(d):d(a)},construct:function(a,b,c,f,l,h){function e(b){D&&d.setObject(D,b);for(r=0;r<I.length;r++)p[I[r].advice||"after"](b,I[r].method,d.hitch(b,I[r].func),!0);for(r=0;r<L.length;r++)L[r].call(b);for(r=0;r<K.length;r++)b.watch(K[r].prop,K[r].func);for(r=0;r<J.length;r++)C(b,J[r].event,J[r].func);return b}var g=a&&a.prototype;f=f||{};var q={};f.defaults&&d.mixin(q,f.defaults);h&&d.mixin(q,h);var w;y("dom-attributes-explicit")?w=b.attributes:
y("dom-attributes-specified-flag")?w=t.filter(b.attributes,function(b){return b.specified}):(h=(/^input$|^img$/i.test(b.nodeName)?b:b.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),w=t.map(h.split(/\s+/),function(a){var c=a.toLowerCase();return{name:a,value:"LI"==b.nodeName&&"value"==a||"enctype"==c?b.getAttribute(c):b.getAttributeNode(c).value}}));var v=f.scope||n._scopeName;h="data-"+v+"-";var m={};"dojo"!==v&&(m[h+"props"]=
"data-dojo-props",m[h+"type"]="data-dojo-type",m[h+"mixins"]="data-dojo-mixins",m[v+"type"]="dojotype",m[h+"id"]="data-dojo-id");for(var r=0,x,v=[],D,B;x=w[r++];){var F=x.name,H=F.toLowerCase();x=x.value;switch(m[H]||H){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":B=x;break;case "data-dojo-id":case "jsid":D=x;break;case "data-dojo-attach-point":case "dojoattachpoint":q.dojoAttachPoint=x;break;case "data-dojo-attach-event":case "dojoattachevent":q.dojoAttachEvent=
x;break;case "class":q["class"]=b.className;break;case "style":q.style=b.style&&b.style.cssText;break;default:if(F in g||(F=k(a)[H]||F),F in g)switch(typeof g[F]){case "string":q[F]=x;break;case "number":q[F]=x.length?Number(x):NaN;break;case "boolean":q[F]="false"!=x.toLowerCase();break;case "function":""===x||-1!=x.search(/[^\w\.]+/i)?q[F]=new Function(x):q[F]=d.getObject(x,!1)||new Function(x);v.push(F);break;default:H=g[F],q[F]=H&&"length"in H?x?x.split(/\s*,\s*/):[]:H instanceof Date?""==x?new Date(""):
"now"==x?new Date:u.fromISOString(x):H instanceof A?n.baseUrl+x:G(x)}else q[F]=x}}for(w=0;w<v.length;w++)m=v[w].toLowerCase(),b.removeAttribute(m),b[m]=null;if(B)try{B=G.call(f.propsThis,"{"+B+"}"),d.mixin(q,B)}catch(M){throw Error(M.toString()+" in data-dojo-props\x3d'"+B+"'");}d.mixin(q,c);l||(l=a&&(a._noScript||g._noScript)?[]:z("\x3e script[type^\x3d'dojo/']",b));var I=[],L=[],K=[],J=[];if(l)for(r=0;r<l.length;r++)m=l[r],b.removeChild(m),c=m.getAttribute(h+"event")||m.getAttribute("event"),f=
m.getAttribute(h+"prop"),B=m.getAttribute(h+"method"),v=m.getAttribute(h+"advice"),w=m.getAttribute("type"),m=this._functionFromScript(m,h),c?"dojo/connect"==w?I.push({method:c,func:m}):"dojo/on"==w?J.push({event:c,func:m}):q[c]=m:"dojo/aspect"==w?I.push({method:B,advice:v,func:m}):"dojo/watch"==w?K.push({prop:f,func:m}):L.push(m);a=(l=a.markupFactory||g.markupFactory)?l(q,b,a):new a(q,b);return a.then?a.then(e):e(a)},scan:function(a,b){function k(b){if(!b.inherited){b.inherited={};var a=b.node,c=
k(b.parent),a={dir:a.getAttribute("dir")||c.dir,lang:a.getAttribute("lang")||c.lang,textDir:a.getAttribute(p)||c.textDir},e;for(e in a)a[e]&&(b.inherited[e]=a[e])}return b.inherited}var d=[],l=[],h={},f=(b.scope||n._scopeName)+"Type",g="data-"+(b.scope||n._scopeName)+"-",w=g+"type",p=g+"textdir",g=g+"mixins",v=a.firstChild,r=b.inherited;if(!r){var x=function(b,a){return b.getAttribute&&b.getAttribute(a)||b.parentNode&&x(b.parentNode,a)},r={dir:x(a,"dir"),lang:x(a,"lang"),textDir:x(a,p)},u;for(u in r)r[u]||
delete r[u]}u={inherited:r};for(var A,z;;)if(v)if(1!=v.nodeType)v=v.nextSibling;else if(A&&"script"==v.nodeName.toLowerCase())(r=v.getAttribute("type"))&&/^dojo\/\w/i.test(r)&&A.push(v),v=v.nextSibling;else if(z)v=v.nextSibling;else if(r=v.getAttribute(w)||v.getAttribute(f),a=v.firstChild,r||a&&(3!=a.nodeType||a.nextSibling)){z=null;if(r){var B=v.getAttribute(g);A=B?[r].concat(B.split(/\s*,\s*/)):[r];try{z=c(A,b.contextRequire)}catch(I){}z||t.forEach(A,function(b){~b.indexOf("/")&&!h[b]&&(h[b]=!0,
l[l.length]=b)});B=z&&!z.prototype._noScript?[]:null;u={types:A,ctor:z,parent:u,node:v,scripts:B};u.inherited=k(u);d.push(u)}else u={node:v,scripts:A,parent:u};A=B;z=v.stopParser||z&&z.prototype.stopParser&&!b.template;v=a}else v=v.nextSibling;else{if(!u||!u.node)break;v=u.node.nextSibling;z=!1;u=u.parent;A=u.scripts}var C=new D;l.length?(y("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+l.join(", ")),(b.contextRequire||m)(l,function(){C.resolve(t.filter(d,function(a){if(!a.ctor)try{a.ctor=
c(a.types,b.contextRequire)}catch(J){}for(var k=a.parent;k&&!k.types;)k=k.parent;var e=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(e&&e.stopParser&&!b.template);a.instantiate=!k||k.instantiate&&k.instantiateChildren;return a.instantiate}))})):C.resolve(d);return C.promise},_require:function(a,b){a=G("{"+a.innerHTML+"}");var c=[],k=[],l=new D;b=b&&b.contextRequire||m;for(var h in a)c.push(h),k.push(a[h]);b(k,function(){for(var b=0;b<c.length;b++)d.setObject(c[b],arguments[b]);l.resolve(arguments)});
return l.promise},_scanAmd:function(a,b){var c=new D,k=c.promise;c.resolve(!0);var d=this;z("script[type\x3d'dojo/require']",a).forEach(function(a){k=k.then(function(){return d._require(a,b)});a.parentNode.removeChild(a)});return k},parse:function(c,b){!c||"string"==typeof c||"nodeType"in c||(b=c,c=b.rootNode);var k=c?a.byId(c):r.body();b=b||{};var f=b.template?{template:!0}:{},l=[],h=this;c=this._scanAmd(k,b).then(function(){return h.scan(k,b)}).then(function(a){return h._instantiate(a,f,b,!0)}).then(function(b){return l=
l.concat(b)}).otherwise(function(b){console.error("dojo/parser::parse() error",b);throw b;});d.mixin(l,c);return l}};n.parser=x;f.parseOnLoad&&B(100,x,"parse");return x})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(m,n){var d={};m.setObject("dojo.date.stamp",d);d.fromISOString=function(m,f){d._isoRegExp||(d._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var a=d._isoRegExp.exec(m);m=null;
if(a){a.shift();a[1]&&a[1]--;a[6]&&(a[6]*=1E3);f&&(f=new Date(f),n.forEach(n.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(a){return f["get"+a]()}),function(d,f){a[f]=a[f]||d}));m=new Date(a[0]||1970,a[1]||0,a[2]||1,a[3]||0,a[4]||0,a[5]||0,a[6]||0);100>a[0]&&m.setFullYear(a[0]||1970);var r=0,t=a[7]&&a[7].charAt(0);"Z"!=t&&(r=60*(a[8]||0)+(Number(a[9])||0),"-"!=t&&(r*=-1));t&&(r-=m.getTimezoneOffset());r&&m.setTime(m.getTime()+6E4*r)}return m};d.toISOString=function(d,
f){var a=function(a){return 10>a?"0"+a:a};f=f||{};var n=[],m=f.zulu?"getUTC":"get",p="";"time"!=f.selector&&(p=d[m+"FullYear"](),p=["0000".substr((p+"").length)+p,a(d[m+"Month"]()+1),a(d[m+"Date"]())].join("-"));n.push(p);"date"!=f.selector&&(p=[a(d[m+"Hours"]()),a(d[m+"Minutes"]()),a(d[m+"Seconds"]())].join(":"),m=d[m+"Milliseconds"](),f.milliseconds&&(p+="."+(100>m?"0":"")+a(m)),f.zulu?p+="Z":"time"!=f.selector&&(d=d.getTimezoneOffset(),f=Math.abs(d),p+=(0<d?"-":"+")+a(Math.floor(f/60))+":"+a(f%
60)),n.push(p));return n.join("T")};return d})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(m,n,d,t,f,a){return m([a,f],{_onMap:function(a){var d=this.constructor._onMap,f;d&&d.FINAL||(delete this.constructor._onMap,d=this.registerConnectEvents(),d.FINAL=!0);a=a.toLowerCase();d[a]?f=this[d[a].method]:(a=this._onCamelCase(a),this[a]&&(f=a));return f},on:function(a,d){var f=this._onMap(a),g=a.replace(/\-/g,
""),m="on"+g in this.domNode;return f||!m?this.inherited(arguments):this.own(t(this.domNode,g,d))[0]},emit:function(a,d,f){var g,m,p,r=a.toLowerCase(),t=this.constructor._onMap||this.registerConnectEvents();m=this[this._onMap(r)];d=d||{};d.target||(d.target=this);m&&t&&t[r]&&(this._onObj2Arr(function(){g=Array.prototype.slice.call(arguments)},t[r].argKeys)(d),p=n.mixin({},arguments),p[2]=g,p[0]=t[r].name.replace(/^on/,""));return this.inherited(p||arguments)}})})},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","dojo/has","../kernel"],function(m,n,d,t,f){m=m(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],queryable:!1,showPopup:!1,constructor:function(a){a&&(this.name=a.name,this.title=a.title,this.description=a.description,this.extent=a.extent,this.legendURL=a.legendURL,this.subLayers=a.subLayers?a.subLayers:[],this.allExtents=a.allExtents?a.allExtents:[],
this.spatialReferences=a.spatialReferences?a.spatialReferences:[],this.queryable=!!a.queryable,this.showPopup=!!a.showPopup)},clone:function(){var a={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},f;this.extent&&(a.extent=this.extent.getExtent());a.subLayers=[];d.forEach(this.subLayers,function(d){a.subLayers.push(d.clone())});a.allExtents=[];for(f in this.allExtents)f=parseInt(f,10),isNaN(f)||(a.allExtents[f]=this.allExtents[f].getExtent());a.spatialReferences=
[];d.forEach(this.spatialReferences,function(d){a.spatialReferences.push(d)});a.queryable=this.queryable;a.showPopup=this.showPopup;return a}});t("extend-esri")&&n.setObject("layers.WMSLayerInfo",m,f);return m})},"*noref":1}});
define("esri/layers/WMSLayer","require dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff ../config ../graphic ../kernel ../request ../urlUtils ../dijit/PopupTemplate ../SpatialReference ../geometry/Extent ../geometry/Point ./DynamicMapServiceLayer ./WMSLayerInfo dojo/query".split(" "),function(m,n,d,t,f,a,r,A,p,g,u,D,y,z,C,B,G){d=d([B],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,
2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,
27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],version:null,constructor:function(a,c){var d=u.urlToObject(a);d.query&&(d.query.version||d.query.Version||d.query.VERSION)&&(this.version=d.query.version||d.query.Version||d.query.VERSION);this.url=a=this._stripParameters(a,"version service request bbox format height width layers srs crs styles transparent bgcolor exceptions time elevation sld wfs".split(" "));
this._url=u.urlToObject(a);this._getCapabilitiesURL=a;this._initLayer=t.hitch(this,this._initLayer);this._parseCapabilities=t.hitch(this,this._parseCapabilities);this._getCapabilitiesError=t.hitch(this,this._getCapabilitiesError);c?(this.customParameters=c.customParameters,this.customLayerParameters=c.customLayerParameters,this.imageFormat=this._getImageFormat(c.format),this.imageTransparency=!1!==c.transparent,this.visibleLayers=c.visibleLayers?c.visibleLayers:[],this.version=c.version||this.version,
c.resourceInfo?this._readResourceInfo(c.resourceInfo):this._getCapabilities()):(this.imageFormat="image/png",this.imageTransparency=!0,this.visibleLayers=[],this._getCapabilities());this._blankImageURL=m.toUrl("../images/pixel.png");this.extentProcessor=this._createExtentProcessor(0);this._createChildLayer()},setVisibleLayers:function(a){this.visibleLayers=(a=this._checkVisibleLayersList(a))?a:[];this.refresh(!0)},setImageFormat:function(a){this.imageFormat=this._getImageFormat(a);this.refresh(!0)},
setImageTransparency:function(a){this.imageTransparency=a;this.refresh(!0)},setCustomParameters:function(a,c){this.customParameters=a;this.customLayerParameters=c;this.refresh(!0)},refresh:function(){this._refreshTS=Date.now();this.inherited(arguments);this._childLayer&&this._childLayer.refresh.apply(this._childLayer,arguments)},getImageUrl:function(a,c,d,f){if(this.visibleLayers&&0!==this.visibleLayers.length){a=this._getImageParams(a,c,d);a=this._mixinCustomLayerParameters(a);c=this.getMapURL;var k;
c+=-1===c.indexOf("?")?"?":"";for(k in a)a.hasOwnProperty(k)&&(c+="?"===c.substring(c.length-1,c.length)?"":"\x26",c+=k+"\x3d"+a[k]);c=this.addTimestampToURL(c);f(u.addProxy(c))}else f(this._blankImageURL)},_setMap:function(a,c,d){var k=this.inherited(arguments);a.wrapAround180?this._childLayer&&(this.suspended&&this._childLayer.suspend(),this._childLayer._setMap(a,k)):this._childLayer=this.extentProcessor=null;return k},_unsetMap:function(a,c){this._childLayer&&this._childLayer._unsetMap(a,this._div);
this.inherited(arguments)},onSuspend:function(){this.inherited(arguments);this._childLayer&&this._childLayer.suspend()},onResume:function(){this.inherited(arguments);this._childLayer&&this._childLayer.resume()},_createChildLayer:function(){this._childLayer=new B(null,{extentProcessor:this._createExtentProcessor(1)});this._childLayer._isChildLayer=!0;this._childLayer.getImageUrl=t.hitch(this,this.getImageUrl);this._childLayer.loaded=!0},_createExtentProcessor:function(a){return t.hitch(this,this._extentProcessor,
a)},_extentProcessor:function(a,c){var d=c.extent,k=c.width,f=0;if(d){c=d.getWidth()/k;var b=d.bisect(),d=b.extents,e=d[a];e&&(k=b.marginLeft/c,f=0===a?k:k+d[0].getWidth()/c,k=Math.ceil(e.getWidth()/c),f=Math.ceil(f));d=e}return{extent:d,width:k,marginLeft:f}},_getImageParams:function(a,c,d){var k=a.spatialReference.wkid;-1===f.indexOf(this.spatialReferences,k)&&a.spatialReference.latestWkid&&(k=a.spatialReference.latestWkid);if(f.some(this._WEB_MERCATOR,function(b){return b==k})){var g=f.filter(this.spatialReferences,
function(b){return f.some(this._WEB_MERCATOR,function(a){return a==b})},this);0===g.length&&(g=f.filter(this.spatialReferences,function(b){return f.some(this._WORLD_MERCATOR,function(a){return a==b})},this));k=0<g.length?g[0]:this._WEB_MERCATOR[1]}this.spatialReferences=f.filter(this.spatialReferences,function(b){return b!==k});this.spatialReferences.unshift(k);var g=a.xmin,b=a.xmax,e=a.ymin;a=a.ymax;var q={SERVICE:"WMS",REQUEST:"GetMap"};q.FORMAT=this.imageFormat;q.TRANSPARENT=this.imageTransparency?
"TRUE":"FALSE";q.STYLES="";q.VERSION=this.version;q.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;q.WIDTH=c;q.HEIGHT=d;this.maxWidth<c&&(q.WIDTH=this.maxWidth);this.maxHeight<d&&(q.HEIGHT=this.maxHeight);c=k?k:NaN;isNaN(c)||("1.3.0"==this.version?q.CRS="EPSG:"+c:q.SRS="EPSG:"+c);"1.3.0"==this.version&&this._useLatLong(c)?q.BBOX=e+","+g+","+a+","+b:q.BBOX=g+","+e+","+b+","+a;return q},_initLayer:function(d,c){this.spatialReference=new y(this.extent.spatialReference);this.initialExtent=
new z(this.extent);this.fullExtent=new z(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);var k=t.hitch(this,function(){this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))});a("chrome")?(d=r.defaults.io,c="with-credentials"===d.useCors?u.canUseXhr(this.getMapURL,!0):-1,(d=-1<c?d.corsEnabledServers[c]:null)&&d.withCredentials?g({url:this.getMapURL,handleAs:"text",content:{SERVICE:"WMS",REQUEST:"GetMap"}}).addBoth(function(){k()}):
k()):k()},_readResourceInfo:function(a){a.extent?a.layerInfos?(this.extent=a.extent,this.allExtents[0]=a.extent,this.layerInfos=a.layerInfos,this.description=a.description?a.description:"",this.copyright=a.copyright?a.copyright:"",this.title=a.title?a.title:"",this.getMapURL=a.getMapURL?a.getMapURL:this._getCapabilitiesURL,this.getFeatureInfoURL=a.getFeatureInfoURL,this.featureInfoFormat=a.featureInfoFormat,this.version=a.version?a.version:"1.3.0",this.maxWidth=a.maxWidth?a.maxWidth:5E3,this.maxHeight=
a.maxHeight?a.maxHeight:5E3,this.spatialReferences=a.spatialReferences?a.spatialReferences:[],this.imageFormat=this._getImageFormat(a.format),this.setScaleRange(a.minScale,a.maxScale),this.customLayerParameters=a.customLayerParameters||this.customLayerParameters,this.customParameters=a.customParameters||this.customParameters,this._initLayer()):this._errorHandler(Error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo")):this._errorHandler(Error("esri.layers.WMSLayer: Unable to find the 'extent' property in resourceInfo."))},
_getCapabilities:function(a){var c=this._url.query?this._url.query:{};c.SERVICE="WMS";c.REQUEST="GetCapabilities";this.version&&(c.VERSION=this.version);var c=this._mixinCustomParameters(c),d=this._url.path+"?",k;for(k in c)c.hasOwnProperty(k)&&(d+="?"==d.substring(d.length-1,d.length)?"":"\x26",d+=k+"\x3d"+c[k]);g({url:d,handleAs:a||"xml",headers:{"Content-Type":null},load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:!1})},_parseCapabilities:function(a,c){var d;if(a){if("text"===
c.handleAs){try{d=(new DOMParser).parseFromString(a,"application/xml")}catch(h){}d&&!d.getElementsByTagName("parsererror").length||this._errorHandler(Error("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (XML Parse error.)"))}else d=a;var k=this;this.version=this._getAttributeValue("WMS_Capabilities","version",d,null);this.version||(this.version=this._getAttributeValue("WMT_MS_Capabilities","version",d,"1.3.0"));a=this._getTag("Service",d);this.title=this._getTagValue("Title",a,
"");this.title||(this.title=this._getTagValue("Name",a,""));this.copyright=this._getTagValue("AccessConstraints",a,"");this.description=this._getTagValue("Abstract",a,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",a,5E3),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",a,5E3),10);if(a=this._getTag("Layer",d)){var g=this._getLayerInfo(a),b=0,e=null;a=this._getTag("Capability",d);f.forEach(a.childNodes,function(a){"Layer"==a.nodeName&&(0===b?e=a:(1===b&&g.name&&(g.name="",g.subLayers=
[],g.subLayers.push(this._getLayerInfo(e))),g.subLayers.push(this._getLayerInfo(a))),b++)},this);if(g&&(this.layerInfos=g.subLayers,this.layerInfos&&0!==this.layerInfos.length||(this.layerInfos=[g]),this.extent=g.extent,this.extent||(g.extent=new z(this.layerInfos[0].extent.toJson()),this.extent=g.extent),this.allExtents=g.allExtents,this.allExtents&&this.allExtents.length||(g.allExtents=[],f.forEach(this.layerInfos[0].allExtents,function(b,a){b&&(g.allExtents[a]=new z(b.toJson()))}),this.allExtents=
g.allExtents),this.spatialReferences=g.spatialReferences,!this.spatialReferences.length&&0<this.layerInfos.length)){var q=function(b){var a;for(a=0;a<b.subLayers.length;a++){var c=b.subLayers[a],d=c.spatialReferences;!d.length&&c.subLayers&&0<c.subLayers.length&&(d=q(c));if(d.length)return d}return[]};for(a=0;a<this.layerInfos.length&&(c=this.layerInfos[a],this.spatialReferences=this.layerInfos[0].spatialReferences,!this.spatialReferences.length&&c.subLayers&&0<c.subLayers.length&&(this.spatialReferences=
q(c)),!this.spatialReferences.length);a++);}a=function(b){return(b=n.query("DCPType",k._getTag(b,d)))&&0<b.length&&(b=n.query("HTTP",b[0]))&&0<b.length&&(b=n.query("Get",b[0]))&&0<b.length&&(b=k._getAttributeValue("OnlineResource","xlink:href",b[0],null))?(b.indexOf("\x26")===b.length-1&&(b=b.substring(0,b.length-1)),k._stripParameters(b,["service","request"])):null};c=function(b){var a=[];0===n.query("Operation",d).length?f.forEach(n.query("Format",k._getTag(b,d)),function(b){a.push(b.text?b.text:
b.textContent)}):(f.forEach(n.query("Operation",d),function(c){c.getAttribute("name")===b&&f.forEach(n.query("Format",c),function(b){a.push(b.text?b.text:b.textContent)})}),a.length||f.forEach(n.query("Format",k._getTag(b,d)),function(b){a.push(b.text?b.text:b.textContent)}));return a};this.getMapURL=a("GetMap")||this._getCapabilitiesURL;this.getMapFormats=c("GetMap");this.getMapFormats.length&&!f.some(this.getMapFormats,function(b){return-1<b.indexOf(this.imageFormat)},this)&&(this.imageFormat=this.getMapFormats[0]);
if(this.getFeatureInfoURL=a("GetFeatureInfo"))this.getFeatureInfoFormats=c("GetFeatureInfo"),-1<f.indexOf(this.getFeatureInfoFormats,"text/html")?this.featureInfoFormat="text/html":-1<f.indexOf(this.getFeatureInfoFormats,"text/plain")&&(this.featureInfoFormat="text/plain");if(!this.featureInfoFormat){var l=function(b){if(b&&(b.queryable=!1,b.subLayers))for(var a=0;a<b.subLayers.length;a++)l(b.subLayers[a])};l(g)}this._initLayer()}else this._errorHandler(Error("esri.layers.WMSLayer: Response does not contain any layers."))}else"xml"===
c.handleAs?this._getCapabilities("text"):this._errorHandler(Error("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)"))},_getCapabilitiesError:function(a){a&&a.message&&(a.message="GetCapabilities request for "+this._getCapabilitiesURL+" failed. ("+a.message+")");this._errorHandler(a)},_getLayerInfo:function(a){if(!a)return null;var c=new G;c.name="";c.title="";c.description="";c.allExtents=[];c.spatialReferences=[];c.queryable="1"===a.getAttribute("queryable");
c.subLayers=[];var d=this._getTag("LatLonBoundingBox",a);d&&(c.allExtents[0]=this._getExtent(d,4326));var k=this._getTag("EX_GeographicBoundingBox",a),g;k&&(g=new z(0,0,0,0,new y({wkid:4326})),g.xmin=parseFloat(this._getTagValue("westBoundLongitude",k,0)),g.ymin=parseFloat(this._getTagValue("southBoundLatitude",k,0)),g.xmax=parseFloat(this._getTagValue("eastBoundLongitude",k,0)),g.ymax=parseFloat(this._getTagValue("northBoundLatitude",k,0)),c.allExtents[0]=g);d||k||(g=new z(-180,-90,180,90,new y({wkid:4326})),
c.allExtents[0]=g);c.extent=c.allExtents[0];var b=-1<f.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)?"SRS":"CRS";f.forEach(a.childNodes,function(a){if("Name"==a.nodeName)c.name=(a.text?a.text:a.textContent)||"";else if("Title"==a.nodeName)c.title=(a.text?a.text:a.textContent)||"";else if("Abstract"==a.nodeName)c.description=(a.text?a.text:a.textContent)||"";else if("BoundingBox"==a.nodeName){var d=a.getAttribute(b);d&&0===d.indexOf("EPSG:")?(d=parseInt(d.substring(5),10),0===d||isNaN(d)||(a="1.3.0"==
this.version?this._getExtent(a,d,this._useLatLong(d)):this._getExtent(a,d),c.allExtents[d]=a,c.extent||(c.extent=a))):d&&0===d.indexOf("CRS:")?(d=parseInt(d.substring(4),10),0===d||isNaN(d)||(this._CRS_TO_EPSG[d]&&(d=this._CRS_TO_EPSG[d]),c.allExtents[d]=this._getExtent(a,d))):(d=parseInt(d,10),0===d||isNaN(d)||(c.allExtents[d]=this._getExtent(a,d)))}else if(a.nodeName==b)a=(a.text?a.text:a.textContent).split(" "),f.forEach(a,function(b){b=-1<b.indexOf(":")?parseInt(b.split(":")[1],10):parseInt(b,
10);0===b||isNaN(b)||(this._CRS_TO_EPSG[b]&&(b=this._CRS_TO_EPSG[b]),-1==f.indexOf(c.spatialReferences,b)&&c.spatialReferences.push(b))},this);else if("Style"!=a.nodeName||c.legendURL)"Layer"===a.nodeName&&c.subLayers.push(this._getLayerInfo(a));else if(a=this._getTag("LegendURL",a))if(a=this._getTag("OnlineResource",a))c.legendURL=a.getAttribute("xlink:href")},this);c.title=c.title||c.name;return c},_getImageFormat:function(a){switch(a?a.toLowerCase():""){case "jpg":return"image/jpeg";case "bmp":return"image/bmp";
case "gif":return"image/gif";case "svg":return"image/svg+xml";default:return"image/png"}},getImageFormat:function(){switch(this.imageFormat?this.imageFormat.toLowerCase():""){case "image/jpeg":return"jpg";case "image/bmp":return"bmp";case "image/gif":return"gif";case "image/svg+xml":return"svg";default:return"png"}},_getExtent:function(a,c,d){var k;if(a){k=new z;var f=parseFloat(a.getAttribute("minx")),b=parseFloat(a.getAttribute("miny")),e=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));
d?(k.xmin=isNaN(b)?-1*Number.MAX_VALUE:b,k.ymin=isNaN(f)?-1*Number.MAX_VALUE:f,k.xmax=isNaN(a)?Number.MAX_VALUE:a,k.ymax=isNaN(e)?Number.MAX_VALUE:e):(k.xmin=isNaN(f)?-1*Number.MAX_VALUE:f,k.ymin=isNaN(b)?-1*Number.MAX_VALUE:b,k.xmax=isNaN(e)?Number.MAX_VALUE:e,k.ymax=isNaN(a)?Number.MAX_VALUE:a);k.spatialReference=new y({wkid:c})}return k},_useLatLong:function(a){var c,d;for(d=0;d<this._REVERSED_LAT_LONG_RANGES.length;d++){var k=this._REVERSED_LAT_LONG_RANGES[d];if(a>=k[0]&&a<=k[1]){c=!0;break}}return c},
_getTag:function(a,c){return(a=n.query(a,c))&&0<a.length?a[0]:null},_getTagValue:function(a,c,d){return(a=n.query(a,c))&&0<a.length?a[0].text?a[0].text:a[0].textContent:d},_getAttributeValue:function(a,c,d,f){return(a=n.query(a,d))&&0<a.length?a[0].getAttribute(c):f},_checkVisibleLayersList:function(a){if(a&&0<a.length&&this.layerInfos&&0<this.layerInfos.length&&"number"==typeof a[0]){var c=[];f.forEach(a,function(a){a<this.layerInfos.length&&c.push(this.layerInfos[a].name)},this);a=c}return a},_stripParameters:function(a,
c){a=u.urlToObject(a);var d,k=[];for(d in a.query)a.query.hasOwnProperty(d)&&-1===f.indexOf(c,d.toLowerCase())&&k.push(d+"\x3d"+a.query[d]);return a.path+(k.length?"?"+k.join("\x26"):"")},_getPopupGraphic:function(a,c){var d=this.visibleLayers;if(!d||0===d.length)return null;var g=this._popupGraphic;g||(g=new D({title:this.title||"",description:'\x3cdiv style\x3d"position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;"\x3e\x3ciframe src\x3d"{QUERY_URL}" width\x3d"250" height\x3d"147" frameborder\x3d"0" marginwidth\x3d"0" marginheight\x3d"0" style\x3d"position:absolute;top:0;left:0;width:100%;height:100%;border:0;background:url(\''+
m.toUrl("../dijit/images/loading-throb.gif")+"') transparent center no-repeat;\" onload\x3d\"(event.target || event.srcElement).style.background \x3d 'none';\"\x3e\x3c/iframe\x3e\x3c/div\x3e"}),g=this._popupGraphic=new A(null,null,{},g),g._layer=this);var k=function(a){var b=[];if(a&&(a.queryable&&a.showPopup&&a.name&&b.push(a.name),a.subLayers))for(var c=0;c<a.subLayers.length;c++){var d=k(a.subLayers[c]);d.length&&(b=b.concat(d))}return b},b=k({subLayers:this.layerInfos}),b=f.filter(b,function(a){return-1<
f.indexOf(d,a)});if(b.length){var e=this.getFeatureInfoURL;a=this._getImageParams(a.extent,a.width,a.height);a=this._mixinCustomLayerParameters(a);a.REQUEST="GetFeatureInfo";a.INFO_FORMAT=this.featureInfoFormat;a.QUERY_LAYERS=b.join();a.FEATURE_COUNT=25;"1.3.0"===this.version?(a.I=Math.round(c.x),a.J=Math.round(c.y)):(a.X=Math.round(c.x),a.Y=Math.round(c.y));var e=e+(-1===e.indexOf("?")?"?":""),n;for(n in a)a.hasOwnProperty(n)&&(e+="?"===e.substring(e.length-1,e.length)?"":"\x26",e+=n+"\x3d"+a[n]);
g.attributes.QUERY_URL=e;return g}return null},_mixinCustomParameters:function(a){if(this.customParameters)for(var c in this.customParameters)a[c]=encodeURIComponent(this.customParameters[c]);return a},_mixinCustomLayerParameters:function(a){if(this.customLayerParameters||this.customParameters){var c=t.clone(this.customParameters||{});t.mixin(c,this.customLayerParameters||{});for(var d in c)"styles"===d.toLowerCase()&&delete a.STYLES,a[d]=encodeURIComponent(c[d])}return a}});a("extend-esri")&&t.setObject("layers.WMSLayer",
d,p);return d});